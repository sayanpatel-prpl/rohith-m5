---
phase: 01-foundation-infrastructure
plan: 04
type: execute
wave: 3
depends_on: ["01-02", "01-03"]
files_modified:
  - dashboard_build_v2/src/components/brand/BrandProvider.tsx
  - dashboard_build_v2/src/components/brand/useBrand.ts
  - dashboard_build_v2/src/app/App.tsx
  - dashboard_build_v2/src/app/routes.tsx
  - dashboard_build_v2/src/components/layout/AppShell.tsx
  - dashboard_build_v2/src/components/layout/Sidebar.tsx
  - dashboard_build_v2/src/components/layout/TopBar.tsx
  - dashboard_build_v2/src/components/layout/FilterBar.tsx
  - dashboard_build_v2/PROGRESS.md
  - dashboard_build_v2/DECISIONS.md
  - dashboard_build_v2/DATA_CATALOG.md
  - dashboard_build_v2/SOURCE_REFERENCE.md
autonomous: true

must_haves:
  truths:
    - "App shell renders with sidebar, top bar, filter bar, and main content area"
    - "Dark mode toggle works without flash of unstyled content"
    - "Filter bar persists filter state to URL search params"
    - "Multi-tenant branding applies via data-tenant attribute on root element"
    - "Routes are defined for all 11 sections with A&M Value-Add at position 2"
    - "Tracking files PROGRESS.md, DECISIONS.md, DATA_CATALOG.md, SOURCE_REFERENCE.md exist and are populated"
  artifacts:
    - path: "dashboard_build_v2/src/app/App.tsx"
      provides: "Root application with router, query provider, brand provider"
      exports: ["App"]
    - path: "dashboard_build_v2/src/components/layout/AppShell.tsx"
      provides: "Dashboard shell with sidebar + main content area"
      exports: ["AppShell"]
    - path: "dashboard_build_v2/src/app/routes.tsx"
      provides: "11 section routes with A&M Value-Add at position 2"
      exports: ["SECTION_ROUTES"]
    - path: "dashboard_build_v2/src/components/layout/Sidebar.tsx"
      provides: "Navigation sidebar with section links"
      exports: ["Sidebar"]
    - path: "dashboard_build_v2/PROGRESS.md"
      provides: "Phase progress tracking"
    - path: "dashboard_build_v2/DATA_CATALOG.md"
      provides: "Data file to section mapping"
    - path: "dashboard_build_v2/SOURCE_REFERENCE.md"
      provides: "Presenter's data source cheat sheet"
  key_links:
    - from: "dashboard_build_v2/src/app/App.tsx"
      to: "dashboard_build_v2/src/api/query-client.ts"
      via: "QueryClientProvider"
      pattern: "QueryClientProvider.*client.*queryClient"
    - from: "dashboard_build_v2/src/app/App.tsx"
      to: "dashboard_build_v2/src/components/brand/BrandProvider.tsx"
      via: "BrandProvider wrapper"
      pattern: "BrandProvider"
    - from: "dashboard_build_v2/src/components/layout/AppShell.tsx"
      to: "dashboard_build_v2/src/stores/url-sync.ts"
      via: "useFilterUrlSync hook call"
      pattern: "useFilterUrlSync"
    - from: "dashboard_build_v2/src/components/layout/Sidebar.tsx"
      to: "dashboard_build_v2/src/app/routes.tsx"
      via: "SECTION_ROUTES import"
      pattern: "SECTION_ROUTES"
---

<objective>
Wire together the app shell, routing, branding, layout components, and tracking files. This plan creates the application skeleton that section stubs will plug into.

Purpose: This plan integrates Plans 01-03 outputs into a running application frame. After this plan, the dev server shows a working shell with sidebar navigation, filter bar, and main content area ready for sections.
Output: Working app shell with routing, branding, layout, and all tracking files populated.
</objective>

<execution_context>
@C:/Users/rohit/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/rohit/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/01-foundation-infrastructure/01-RESEARCH.md
@.planning/phases/01-foundation-infrastructure/01-01-SUMMARY.md
@.planning/phases/01-foundation-infrastructure/01-02-SUMMARY.md
@.planning/phases/01-foundation-infrastructure/01-03-SUMMARY.md
@.planning/phases/01-foundation-infrastructure/01-05-SUMMARY.md

# V1 reference for app shell and routing
@src/app/App.tsx
@src/app/routes.tsx
@src/components/brand/BrandProvider.tsx
@src/components/layout/AppShell.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create branding, routing, and App.tsx root component</name>
  <files>
    dashboard_build_v2/src/components/brand/BrandProvider.tsx
    dashboard_build_v2/src/components/brand/useBrand.ts
    dashboard_build_v2/src/app/routes.tsx
    dashboard_build_v2/src/app/App.tsx
  </files>
  <action>
    **routes.tsx:** Define SECTION_ROUTES with 11 sections in correct order. CRITICAL: A&M Value-Add MUST be at position 2 (nav position 2 per requirements):
    1. executive - "Executive Snapshot"
    2. am-value-add - "A&M Value-Add Opportunities"
    3. market-pulse - "Market Pulse"
    4. financial - "Financial Performance"
    5. deals - "Deals & Transactions"
    6. operations - "Operational Intelligence"
    7. leadership - "Leadership & Governance"
    8. competitive - "Competitive Moves"
    9. deep-dive - "Sub-Sector Deep Dive"
    10. what-this-means - "What This Means For..."
    11. watchlist - "Watchlist & Forward Indicators"

    Export SectionRoute interface (path, label, icon?) and SECTION_ROUTES array.

    **BrandProvider.tsx (FOUND-04):** Port from v1 with modifications. Create BrandContext with tenantSlug, brandName, brandConfig. BrandProvider reads :tenantSlug from URL params, sets `data-tenant` attribute on document.documentElement (for CSS variable overrides from tokens.css). Default tenant: "am" (this is an A&M presentation). Support "kompete", "bcg", "am" tenants.

    **useBrand.ts:** Custom hook that consumes BrandContext. Returns { tenantSlug, brandName, brandConfig }.

    **App.tsx:** Root component. Port from v1's App.tsx:
    - QueryClientProvider with queryClient
    - BrowserRouter
    - Routes: `/:tenantSlug/report` -> BrandProvider + AppShell
    - Index route redirects to "executive"
    - Each section route: lazy-loaded via lazySections (from sections/index.ts, created in Plan 06), wrapped in Suspense with SectionSkeleton fallback, wrapped in ErrorBoundary with SectionErrorFallback
    - Default redirect: `/` -> `/am/report` (A&M is default tenant for this build)
    - Catch-all: `*` -> `/am/report`
    - Do NOT include ReactQueryDevtools (production build for presentation)
    - NOTE: App.tsx will import lazySections from `../sections/index.ts` which is created in Plan 06. If Plan 04 executes before Plan 06, create a minimal placeholder at `src/sections/index.ts` that exports an empty lazySections object. Plan 06 will overwrite it.
  </action>
  <verify>
    Run `cd dashboard_build_v2 && npx tsc --noEmit` — App.tsx, routes.tsx, BrandProvider.tsx type-check.
    Verify SECTION_ROUTES has 11 entries with am-value-add at index 1 (position 2).
    Verify BrandProvider sets data-tenant attribute on documentElement.
  </verify>
  <done>
    Routes define all 11 sections with A&M Value-Add at position 2. BrandProvider applies multi-tenant branding via data-tenant attribute. App.tsx wires QueryClientProvider, BrowserRouter, BrandProvider, and section routes.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create layout components (AppShell, Sidebar, TopBar, FilterBar)</name>
  <files>
    dashboard_build_v2/src/components/layout/AppShell.tsx
    dashboard_build_v2/src/components/layout/Sidebar.tsx
    dashboard_build_v2/src/components/layout/TopBar.tsx
    dashboard_build_v2/src/components/layout/FilterBar.tsx
  </files>
  <action>
    **AppShell.tsx:** Main layout wrapper. Port from v1's AppShell pattern:
    - Calls `useFilterUrlSync()` at the top level (this is where URL sync lives)
    - Renders fixed Sidebar on the left (260px width)
    - TopBar at top of main content area
    - FilterBar below TopBar
    - Main content area with `<Outlet />` for section routes
    - Uses Tailwind: h-screen flex, main area overflow-y-auto

    **Sidebar.tsx:** Navigation sidebar. Renders:
    - Brand header at top (Kompete logo area with brand name from useBrand)
    - "Industry Intel - Consumer Durables" subtitle
    - SECTION_ROUTES mapped to NavLink components from react-router
    - Active route gets brand-accent left border + highlighted background (match v1 styling)
    - Each nav item: text-sm, py-2.5 px-5, border-l-3 transparent, hover:bg-surface-overlay
    - Active: text-brand-accent, border-l-brand-accent, bg-surface-overlay, font-semibold

    **TopBar.tsx:** Top bar with:
    - Section title (from current route, use react-router's useLocation + lookup in SECTION_ROUTES)
    - Data recency tag (e.g., "Q3 FY2026 | Screener.in")
    - Dark mode toggle button (calls applyTheme from dark-mode.ts). Moon/sun icon toggle.
    - Print button (calls window.print())

    **FilterBar.tsx:** Filter controls bar. Renders 4 filter controls:
    - Company multi-select (from company registry)
    - Sub-category select (AC, Kitchen, Electrical, EMS, Mixed, Cooler, All)
    - Performance tier select (All, Outperform, Inline, Underperform)
    - Time period select (YoY, QoQ)
    - Reset button
    Each control reads from and writes to useFilterStore. Use individual primitive selectors.
    For company multi-select, use a simple dropdown with checkboxes (no need for Radix Combobox — keep it simple for deadline).
  </action>
  <verify>
    Run `cd dashboard_build_v2 && npx tsc --noEmit` — all layout component files type-check.
    Verify AppShell calls useFilterUrlSync().
    Verify Sidebar imports SECTION_ROUTES and maps to NavLink.
    Verify FilterBar uses individual primitive selectors from useFilterStore.
  </verify>
  <done>
    AppShell renders dashboard layout with sidebar, top bar, filter bar, and main content area. Sidebar shows all 11 section nav items. FilterBar controls 4 filter dimensions. TopBar shows section title and dark mode toggle. URL sync is active via AppShell.
  </done>
</task>

<task type="auto">
  <name>Task 3: Create tracking files and data catalog</name>
  <files>
    dashboard_build_v2/PROGRESS.md
    dashboard_build_v2/DECISIONS.md
    dashboard_build_v2/DATA_CATALOG.md
    dashboard_build_v2/SOURCE_REFERENCE.md
  </files>
  <action>
    **PROGRESS.md (FOUND-05):** Create progress tracking file with:
    - Header: "# Kompete v2 - Build Progress"
    - Build status table tracking each phase (1-6) with status
    - Section completion checklist (11 sections)
    - Current build stats: file count, bundle size, data files loaded
    - Last updated timestamp
    - Mark Phase 1 as "In Progress", all others as "Not Started"
    - Mark all 11 sections as "[ ] Stub only"

    **DECISIONS.md (FOUND-05):** Create architecture decisions log with:
    - Header: "# Architecture Decisions"
    - Table format: Date | Decision | Rationale | Outcome
    - Pre-populate with Phase 1 decisions:
      1. "Use ECharts over Recharts" — rationale: heatmaps, treemaps, data density
      2. "Static JSON import via @data alias" — rationale: single-file output requires build-time inlining
      3. "Zustand v5 with primitive selectors" — rationale: prevents re-render loops
      4. "A&M as default tenant" — rationale: presentation audience
      5. "ECharts v5 (not v6)" — rationale: echarts-for-react compatibility uncertain with v6
      6. "Anti-clickbait news filtering at data layer" — rationale: low-credibility sources never reach UI

    **DATA_CATALOG.md (DATA-05):** Create data file to section mapping with:
    - Header: "# Data Catalog"
    - Table mapping each JSON file to: file path, size, shape description, sections that consume it, source tier, last updated
    - Files to catalog:
      1. consolidated-dashboard-data.json (401KB) — Executive, Financial, Watchlist, Operations — T1
      2. screener-all-companies.json (348KB) — Financial, Executive — T1
      3. sovrenn-intelligence.json (41KB) — Executive, Watchlist — T3
      4. trendlyne-summary.json (12KB) — Executive, Market Pulse — T1/T2
      5. financial-api-data.json (36KB) — Financial — T1
      6. company-ir-documents.json (32KB) — Reference links — Reference
      7. deals-transactions-capital-movements.csv (28KB) — Deals — T2-T4
      8. Per-company directories — All sections — T1
    - Include a "Company ID Normalization" section showing how different files refer to the same company

    **SOURCE_REFERENCE.md (SRCA-05):** Create presenter's cheat sheet with:
    - Header: "# Source Reference — Presenter's Cheat Sheet"
    - Purpose: "Every data point traceable in 5 seconds"
    - Organized by data category:
      1. **Financial Data** (Revenue, EBITDA, ROCE, D/E, WC Days) — Source: Screener.in quarterly filings, T1. URL: https://www.screener.in/company/{TICKER}/consolidated/
      2. **Company Overview** (Market Cap, Current Price) — Source: Screener.in, T1
      3. **Growth Triggers** — Source: Sovrenn Intelligence, T3
      4. **Market Metrics** — Source: Trendlyne.com, T1/T2
      5. **Deals & Transactions** — Source: Various (Annual Reports, Press Releases), T2-T4
      6. **Operational Intelligence** — Source: Company filings, Trendlyne, T1-T2
      7. **News & Sentiment** — Source: TBD (arriving Sunday), T2-T4
    - Each entry: data point name, source, tier, how to verify (URL or filing reference)
    - Confidence note: "T1 = Hard financial filings, T2 = Verified alternative data, T3 = Curated intelligence, T4 = News & sentiment (filtered for credibility)"
  </action>
  <verify>
    All 4 files exist in dashboard_build_v2/ root.
    PROGRESS.md has Phase 1 marked as in-progress.
    DECISIONS.md has at least 5 entries.
    DATA_CATALOG.md maps all 7+ data files to sections.
    SOURCE_REFERENCE.md has entries organized by data category with tier labels.
  </verify>
  <done>
    All 4 tracking files created and populated per FOUND-05, DATA-05, and SRCA-05. PROGRESS.md tracks build status. DECISIONS.md logs architecture choices. DATA_CATALOG.md maps every data file to sections. SOURCE_REFERENCE.md enables 5-second data traceability for presenters.
  </done>
</task>

</tasks>

<verification>
1. App.tsx wires QueryClientProvider, BrowserRouter, BrandProvider
2. Sidebar shows 11 sections with A&M Value-Add at position 2
3. Dark mode toggle works without FOUC
4. Filter bar shows 4 filter controls connected to Zustand store
5. URL updates when filters change (e.g., ?companies=voltas&tier=outperform)
6. All 4 tracking files exist in dashboard_build_v2/
7. `npx tsc --noEmit` passes for all files
</verification>

<success_criteria>
- App shell renders with sidebar, filter bar, dark mode, and 11 section routes defined
- A&M Value-Add is at nav position 2
- Default tenant is "am", multi-tenant branding works via data-tenant attribute
- All 4 tracking files (PROGRESS.md, DECISIONS.md, DATA_CATALOG.md, SOURCE_REFERENCE.md) exist and are populated
- URL sync works (filter changes reflect in URL params)
- Layout components (AppShell, Sidebar, TopBar, FilterBar) type-check and render correctly
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-infrastructure/01-04-SUMMARY.md`
</output>
