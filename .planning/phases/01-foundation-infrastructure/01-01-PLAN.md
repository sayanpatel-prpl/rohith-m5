---
phase: 01-foundation-infrastructure
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - dashboard_build_v2/package.json
  - dashboard_build_v2/vite.config.ts
  - dashboard_build_v2/tsconfig.json
  - dashboard_build_v2/tsconfig.app.json
  - dashboard_build_v2/tsconfig.node.json
  - dashboard_build_v2/index.html
  - dashboard_build_v2/src/main.tsx
  - dashboard_build_v2/src/types/common.ts
  - dashboard_build_v2/src/types/filters.ts
  - dashboard_build_v2/src/types/source.ts
  - dashboard_build_v2/src/types/news.ts
  - dashboard_build_v2/src/types/company.ts
  - dashboard_build_v2/src/types/am-theme.ts
  - dashboard_build_v2/src/types/sections.ts
  - dashboard_build_v2/src/theme/tokens.css
  - dashboard_build_v2/src/theme/dark-mode.ts
  - dashboard_build_v2/src/lib/formatters.ts
  - dashboard_build_v2/src/lib/company-matching.ts
  - dashboard_build_v2/src/lib/source-utils.ts
autonomous: true

must_haves:
  truths:
    - "dashboard_build_v2/ is an independent React+Vite+TS project that installs and type-checks without errors"
    - "Vite config resolves @data alias to consumer-durables-intelligence/data_sources/extracted/ and @ alias to src/"
    - "Theme tokens include dark mode variants, A&M action-type colors, tenant overrides, and chart palette"
    - "All TypeScript types are defined: SourceInfo, NewsItem, AMServiceLine, AMActionType, FilterState, SectionId, Company"
    - "Utility functions (formatters, company matching, source utils) are ported from v1 with additions for safeDisplay and source tier helpers"
  artifacts:
    - path: "dashboard_build_v2/package.json"
      provides: "Project manifest with all dependencies"
      contains: "echarts"
    - path: "dashboard_build_v2/vite.config.ts"
      provides: "Vite build config with singlefile, tailwind, path aliases"
      contains: "@data"
    - path: "dashboard_build_v2/src/types/source.ts"
      provides: "SourceInfo, SourceTier, SourceConfidence types"
      exports: ["SourceInfo", "SourceTier", "SourceConfidence"]
    - path: "dashboard_build_v2/src/types/news.ts"
      provides: "NewsItem interface with credibility fields"
      exports: ["NewsItem"]
    - path: "dashboard_build_v2/src/types/am-theme.ts"
      provides: "AMServiceLine and AMActionType types"
      exports: ["AMServiceLine", "AMActionType"]
    - path: "dashboard_build_v2/src/theme/tokens.css"
      provides: "All CSS design tokens including A&M colors"
      contains: "am-turnaround"
  key_links:
    - from: "dashboard_build_v2/vite.config.ts"
      to: "../consumer-durables-intelligence/data_sources/extracted"
      via: "resolve.alias @data"
      pattern: "@data.*data_sources"
    - from: "dashboard_build_v2/src/main.tsx"
      to: "dashboard_build_v2/src/theme/tokens.css"
      via: "CSS import"
      pattern: "import.*tokens\\.css"
---

<objective>
Scaffold the dashboard_build_v2/ project with all configuration, type definitions, theme tokens, and utility libraries.

Purpose: This is the foundation that every subsequent plan depends on. Without project config, types, and theme tokens, nothing else can be built.
Output: A fully configured React+Vite+TS project that installs, type-checks, and has all shared types and utilities ready for consumption.
</objective>

<execution_context>
@C:/Users/rohit/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/rohit/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation-infrastructure/01-RESEARCH.md

# V1 reference files to carry forward patterns from
@vite.config.ts
@package.json
@index.html
@src/main.tsx
@src/theme/tokens.css
@src/theme/dark-mode.ts
@src/types/filters.ts
@src/types/common.ts
@src/lib/formatters.ts
@src/lib/company-matching.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create project scaffold with Vite config and dependencies</name>
  <files>
    dashboard_build_v2/package.json
    dashboard_build_v2/vite.config.ts
    dashboard_build_v2/tsconfig.json
    dashboard_build_v2/tsconfig.app.json
    dashboard_build_v2/tsconfig.node.json
    dashboard_build_v2/index.html
    dashboard_build_v2/src/main.tsx
  </files>
  <action>
    Create the `dashboard_build_v2/` directory as an independent project (FOUND-01).

    **package.json:** Name `kompete-v2`, type `module`. Scripts: `dev` (vite), `build` (tsc -b && vite build), `lint` (eslint .), `preview` (vite preview), `test` (vitest run), `test:watch` (vitest).
    Dependencies: react ^19.2.4, react-dom ^19.2.4, @tanstack/react-query ^5.90.21, zustand ^5.0.11, react-router ^7.13.0, echarts ^5.5, echarts-for-react ^3.0.6, @tanstack/react-table ^8.21.3, clsx ^2.1.1, react-error-boundary ^6.1.1, radix-ui ^1.4.3.
    DevDependencies: typescript ^5.9.3, vite ^7.3.1, @vitejs/plugin-react ^5.1.4, tailwindcss ^4.1.18, @tailwindcss/vite ^4.1.18, vite-plugin-singlefile ^2.3.0, @types/react ^19.2.14, @types/react-dom ^19.2.3, vitest ^4.0.18.

    **vite.config.ts:** Use `defineConfig` with plugins: react(), tailwindcss(), viteSingleFile(). Set `base: './'`. Configure `resolve.alias`: `@` -> `./src`, `@data` -> `../consumer-durables-intelligence/data_sources/extracted`. Set `build.assetsInlineLimit: 100000000` to inline everything (FOUND-02). Use `path` module with `import path from 'path'` and `import { fileURLToPath } from 'url'` for __dirname in ESM.

    **tsconfig.json:** References-only config pointing to tsconfig.app.json and tsconfig.node.json.
    **tsconfig.app.json:** Target ES2020, module ESNext, moduleResolution bundler, jsx react-jsx, strict true, skipLibCheck true, include ["src"]. Add paths: `@/*` -> `["./src/*"]`, `@data/*` -> `["../consumer-durables-intelligence/data_sources/extracted/*"]`. Set `resolveJsonModule: true` to enable JSON imports.
    **tsconfig.node.json:** Target ES2022, module ESNext, moduleResolution bundler, include ["vite.config.ts"].

    **index.html:** Match v1's structure. Include Inter + JetBrains Mono font preconnects. Include inline dark mode script (FOUC prevention) that checks localStorage for 'theme-preference' and adds .dark class before React renders. Root div with id="root". Script tag: `<script type="module" src="/src/main.tsx"></script>`. Title: "Kompete v2 - A&M Consumer Durables Intelligence".

    **src/main.tsx:** Import tokens.css, import initTheme from dark-mode, import App. Call initTheme() before createRoot. Render App in StrictMode. Match v1's main.tsx pattern exactly.

    Run `cd dashboard_build_v2 && npm install` after creating files.
  </action>
  <verify>
    Run `cd dashboard_build_v2 && npm install` succeeds without errors.
    Run `cd dashboard_build_v2 && npx tsc --noEmit` passes (may have import errors for not-yet-created files -- that's OK at this stage since main.tsx imports App which doesn't exist yet; verify package.json and vite.config.ts are valid).
    Verify `node_modules/` is created with echarts, @tanstack/react-table, etc.
  </verify>
  <done>
    dashboard_build_v2/ exists as independent project with all dependencies installed. Vite config has @data alias pointing to data_sources/extracted/. Build toolchain is ready.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create all TypeScript type definitions and theme tokens</name>
  <files>
    dashboard_build_v2/src/types/common.ts
    dashboard_build_v2/src/types/filters.ts
    dashboard_build_v2/src/types/source.ts
    dashboard_build_v2/src/types/news.ts
    dashboard_build_v2/src/types/company.ts
    dashboard_build_v2/src/types/am-theme.ts
    dashboard_build_v2/src/types/sections.ts
    dashboard_build_v2/src/theme/tokens.css
    dashboard_build_v2/src/theme/dark-mode.ts
  </files>
  <action>
    **src/types/common.ts:** Export SectionId type as union of 11 section path strings: 'executive' | 'am-value-add' | 'market-pulse' | 'financial' | 'deals' | 'operations' | 'leadership' | 'competitive' | 'deep-dive' | 'what-this-means' | 'watchlist'. Export ConfidenceLevel = 'verified' | 'derived' | 'estimated'.

    **src/types/filters.ts:** Port verbatim from v1 (src/types/filters.ts). FilterState with companies: string[], subCategory: string, performanceTier: string, timePeriod: string. DEFAULT_FILTERS and FilterActions interfaces unchanged.

    **src/types/source.ts (SRCA-01):** Export SourceTier = 1 | 2 | 3 | 4. Export SourceConfidence = 'verified' | 'derived' | 'estimated'. Export SourceInfo interface with: source: string, confidence: SourceConfidence, tier: SourceTier, lastUpdated: string, url?: string.

    **src/types/news.ts (NEWS-01):** Export NewsItem interface with: id: string, headline: string, body: string, source: string, date: string, companyIds: string[], sectionIds: SectionId[], sourceTier: SourceTier, sourceCredibility: 'high' | 'medium' | 'low', corroboratedBy?: string[], contradictedBy?: string[], isVerifiedByFiling?: boolean.

    **src/types/company.ts:** Export Company interface with: id: string, name: string, ticker: string, nseSymbol?: string, subSector: string (e.g., 'AC', 'Kitchen', 'Electrical', 'EMS', 'Mixed', 'Cooler'). Export COMPANY_IDS as const array of 16 company ID strings. Export CompanyId type from the const array. Export getCompanyDisplayName helper.

    **src/types/am-theme.ts (AMTH-02):** Export AMServiceLine = 'CPI' | 'Restructuring' | 'Transaction Advisory' | 'PE Services' | 'Digital' | 'Operations'. Export AMActionType = 'turnaround' | 'improvement' | 'transaction' | 'neutral'. Export AM_SERVICE_LINE_LABELS record mapping each service line to its display label. Export AM_ACTION_COLORS record mapping each action type to its CSS variable name (e.g., 'turnaround' -> 'var(--color-am-turnaround)').

    **src/types/sections.ts:** Export base SectionData interface with: section: SectionId, dataAsOf?: string, lastUpdated?: string. Export SectionMeta interface with: label: string, description: string, icon?: string. This will be extended by individual section data types in later phases.

    **src/theme/tokens.css (FOUND-03, AMTH-01):** Start with `@import "tailwindcss"`. Use @theme directive for all tokens. Copy v1's tokens.css entirely, then ADD:
    - A&M action-type colors: --color-am-turnaround (oklch red), --color-am-improvement (oklch amber), --color-am-transaction (oklch green), --color-am-neutral (oklch slate). Use oklch values from research.
    - Source tier badge colors: --color-tier-1 (green), --color-tier-2 (blue), --color-tier-3 (amber), --color-tier-4 (red).
    - Dark mode overrides for ALL new tokens in .dark block.
    - Tenant overrides for kompete, bcg, am (carry from v1).
    - Print styles (carry from v1).
    - Keep fade-in and accordion keyframes from v1.

    **src/theme/dark-mode.ts:** Port verbatim from v1 (src/theme/dark-mode.ts). ThemePreference type, getStoredTheme, applyTheme, initTheme functions unchanged.
  </action>
  <verify>
    After creating all files, run `cd dashboard_build_v2 && npx tsc --noEmit` -- should pass for the types directory (types are self-contained). If main.tsx causes errors due to missing App, temporarily comment out imports in main.tsx to verify types compile.
  </verify>
  <done>
    All shared TypeScript types are defined and exportable. Theme tokens.css includes A&M colors, tier badge colors, dark mode variants, and tenant overrides. dark-mode.ts provides theme toggle logic.
  </done>
</task>

<task type="auto">
  <name>Task 3: Create utility libraries (formatters, company matching, source utils)</name>
  <files>
    dashboard_build_v2/src/lib/formatters.ts
    dashboard_build_v2/src/lib/company-matching.ts
    dashboard_build_v2/src/lib/source-utils.ts
  </files>
  <action>
    **src/lib/formatters.ts:** Port from v1 (src/lib/formatters.ts) with all existing formatters (formatINR, formatPercent, formatBasisPoints, formatIndianNumber). ADD the `safeDisplay` function per DATA-04:
    ```
    export function safeDisplay(
      value: number | null | undefined,
      formatter: (v: number) => string,
      tooltip?: string
    ): { text: string; hasData: boolean; tooltip?: string } {
      if (value == null || !isFinite(value)) {
        return { text: '-', hasData: false, tooltip: tooltip ?? 'Data not available' };
      }
      return { text: formatter(value), hasData: true };
    }
    ```
    Keep the module-scope Intl.NumberFormat instances for performance.

    **src/lib/company-matching.ts:** Port from v1 (src/lib/company-matching.ts). The fuzzy matching logic that handles varied display names across data sources. Import COMPANY_IDS from types/company.ts and add a `normalizeCompanyId(rawId: string): string | null` function that maps variant company IDs from different JSON files (e.g., "Voltas Ltd" -> "voltas", "AMBER" -> "amber") to canonical IDs. This function is critical for DATA-04 (Pitfall 4 from research).

    **src/lib/source-utils.ts (new):** Create source tier determination helpers for SRCA-04:
    - `KNOWN_SOURCES` record mapping source name patterns to SourceInfo defaults (e.g., 'screener' -> { tier: 1, confidence: 'verified' }, 'trendlyne' -> { tier: 1, confidence: 'verified' }, 'sovrenn' -> { tier: 3, confidence: 'derived' }).
    - `getSourceForDataPoint(dataSource: string, lastUpdated: string): SourceInfo` — looks up source in KNOWN_SOURCES, returns appropriate SourceInfo. NEVER returns a filename as source — always the human-readable source name (SRCA-04).
    - `isHighConfidence(source: SourceInfo): boolean` — returns true for tier 1-2 with verified confidence.
    - `formatSourceDate(isoDate: string): string` — formats "2026-02-18" to "Feb 18, 2026".
  </action>
  <verify>
    Run `cd dashboard_build_v2 && npx tsc --noEmit` passes for all lib/ files.
    If v1 has tests for formatters and company-matching, port those too and run `cd dashboard_build_v2 && npx vitest run` to verify.
  </verify>
  <done>
    All utility libraries are created: formatters with safeDisplay for graceful degradation, company matching with ID normalization, source utils with tier determination helpers. Types are imported correctly from types/ directory.
  </done>
</task>

</tasks>

<verification>
1. `cd dashboard_build_v2 && npm install` completes successfully
2. `cd dashboard_build_v2 && npx tsc --noEmit` passes (with main.tsx temporarily simplified if App doesn't exist yet)
3. All type files export their declared types without circular dependencies
4. tokens.css contains A&M action-type colors and dark mode variants
5. source-utils.ts NEVER maps to a filename — all sources are human-readable names
</verification>

<success_criteria>
- dashboard_build_v2/ is an installable, type-checkable project
- Vite config has @data alias for JSON imports and viteSingleFile for single-HTML output
- All 7 type definition files exist with correct interfaces
- Theme tokens include A&M colors (turnaround/improvement/transaction/neutral) with dark variants
- formatters.ts includes safeDisplay() for graceful degradation
- company-matching.ts includes normalizeCompanyId() for cross-source ID mapping
- source-utils.ts includes getSourceForDataPoint() that returns human-readable source names
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-infrastructure/01-01-SUMMARY.md`
</output>
