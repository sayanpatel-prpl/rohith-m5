---
phase: 01-foundation-infrastructure
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - dashboard_build_v2/package.json
  - dashboard_build_v2/vite.config.ts
  - dashboard_build_v2/tsconfig.json
  - dashboard_build_v2/tsconfig.app.json
  - dashboard_build_v2/tsconfig.node.json
  - dashboard_build_v2/index.html
  - dashboard_build_v2/src/main.tsx
  - dashboard_build_v2/src/lib/formatters.ts
  - dashboard_build_v2/src/lib/company-matching.ts
  - dashboard_build_v2/src/lib/source-utils.ts
autonomous: true

must_haves:
  truths:
    - "dashboard_build_v2/ is an independent React+Vite+TS project that installs and type-checks without errors"
    - "Vite config resolves @data alias to consumer-durables-intelligence/data_sources/extracted/ and @ alias to src/"
    - "Utility functions (formatters, company matching, source utils) are ported from v1 with additions for safeDisplay and source tier helpers"
  artifacts:
    - path: "dashboard_build_v2/package.json"
      provides: "Project manifest with all dependencies"
      contains: "echarts"
    - path: "dashboard_build_v2/vite.config.ts"
      provides: "Vite build config with singlefile, tailwind, path aliases"
      contains: "@data"
    - path: "dashboard_build_v2/src/lib/formatters.ts"
      provides: "Currency, percentage, basis point formatters + safeDisplay"
      exports: ["formatINR", "formatPercent", "safeDisplay"]
    - path: "dashboard_build_v2/src/lib/source-utils.ts"
      provides: "Source tier determination and KNOWN_SOURCES registry"
      exports: ["getSourceForDataPoint", "isHighConfidence"]
  key_links:
    - from: "dashboard_build_v2/vite.config.ts"
      to: "../consumer-durables-intelligence/data_sources/extracted"
      via: "resolve.alias @data"
      pattern: "@data.*data_sources"
    - from: "dashboard_build_v2/src/main.tsx"
      to: "dashboard_build_v2/src/theme/tokens.css"
      via: "CSS import"
      pattern: "import.*tokens\\.css"
---

<objective>
Scaffold the dashboard_build_v2/ project with all configuration and utility libraries.

Purpose: This is the project foundation — without project config and installed dependencies, nothing else can be built. Utility libraries (formatters, company matching, source utils) are used by every subsequent plan.
Output: A fully configured React+Vite+TS project that installs, with utility libraries ready for consumption.
</objective>

<execution_context>
@C:/Users/rohit/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/rohit/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation-infrastructure/01-RESEARCH.md

# V1 reference files to carry forward patterns from
@vite.config.ts
@package.json
@index.html
@src/main.tsx
@src/lib/formatters.ts
@src/lib/company-matching.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create project scaffold with Vite config and dependencies</name>
  <files>
    dashboard_build_v2/package.json
    dashboard_build_v2/vite.config.ts
    dashboard_build_v2/tsconfig.json
    dashboard_build_v2/tsconfig.app.json
    dashboard_build_v2/tsconfig.node.json
    dashboard_build_v2/index.html
    dashboard_build_v2/src/main.tsx
  </files>
  <action>
    Create the `dashboard_build_v2/` directory as an independent project (FOUND-01).

    **package.json:** Name `kompete-v2`, type `module`. Scripts: `dev` (vite), `build` (tsc -b && vite build), `lint` (eslint .), `preview` (vite preview), `test` (vitest run), `test:watch` (vitest).
    Dependencies: react ^19.2.4, react-dom ^19.2.4, @tanstack/react-query ^5.90.21, zustand ^5.0.11, react-router ^7.13.0, echarts ^5.5, echarts-for-react ^3.0.6, @tanstack/react-table ^8.21.3, clsx ^2.1.1, react-error-boundary ^6.1.1, radix-ui ^1.4.3.
    DevDependencies: typescript ^5.9.3, vite ^7.3.1, @vitejs/plugin-react ^5.1.4, tailwindcss ^4.1.18, @tailwindcss/vite ^4.1.18, vite-plugin-singlefile ^2.3.0, @types/react ^19.2.14, @types/react-dom ^19.2.3, vitest ^4.0.18.

    **vite.config.ts:** Use `defineConfig` with plugins: react(), tailwindcss(), viteSingleFile(). Set `base: './'`. Configure `resolve.alias`: `@` -> `./src`, `@data` -> `../consumer-durables-intelligence/data_sources/extracted`. Set `build.assetsInlineLimit: 100000000` to inline everything (FOUND-02). Use `path` module with `import path from 'path'` and `import { fileURLToPath } from 'url'` for __dirname in ESM.

    **tsconfig.json:** References-only config pointing to tsconfig.app.json and tsconfig.node.json.
    **tsconfig.app.json:** Target ES2020, module ESNext, moduleResolution bundler, jsx react-jsx, strict true, skipLibCheck true, include ["src"]. Add paths: `@/*` -> `["./src/*"]`, `@data/*` -> `["../consumer-durables-intelligence/data_sources/extracted/*"]`. Set `resolveJsonModule: true` to enable JSON imports.
    **tsconfig.node.json:** Target ES2022, module ESNext, moduleResolution bundler, include ["vite.config.ts"].

    **index.html:** Match v1's structure. Include Inter + JetBrains Mono font preconnects. Include inline dark mode script (FOUC prevention) that checks localStorage for 'theme-preference' and adds .dark class before React renders. Root div with id="root". Script tag: `<script type="module" src="/src/main.tsx"></script>`. Title: "Kompete v2 - A&M Consumer Durables Intelligence".

    **src/main.tsx:** Import tokens.css, import initTheme from dark-mode, import App. Call initTheme() before createRoot. Render App in StrictMode. Match v1's main.tsx pattern exactly.

    Run `cd dashboard_build_v2 && npm install` after creating files.
  </action>
  <verify>
    Run `cd dashboard_build_v2 && npm install` succeeds without errors.
    Run `cd dashboard_build_v2 && npx tsc --noEmit` passes (may have import errors for not-yet-created files -- that's OK at this stage since main.tsx imports App which doesn't exist yet; verify package.json and vite.config.ts are valid).
    Verify `node_modules/` is created with echarts, @tanstack/react-table, etc.
  </verify>
  <done>
    dashboard_build_v2/ exists as independent project with all dependencies installed. Vite config has @data alias pointing to data_sources/extracted/. Build toolchain is ready.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create utility libraries (formatters, company matching, source utils)</name>
  <files>
    dashboard_build_v2/src/lib/formatters.ts
    dashboard_build_v2/src/lib/company-matching.ts
    dashboard_build_v2/src/lib/source-utils.ts
  </files>
  <action>
    **src/lib/formatters.ts:** Port from v1 (src/lib/formatters.ts) with all existing formatters (formatINR, formatPercent, formatBasisPoints, formatIndianNumber). ADD the `safeDisplay` function per DATA-04:
    ```
    export function safeDisplay(
      value: number | null | undefined,
      formatter: (v: number) => string,
      tooltip?: string
    ): { text: string; hasData: boolean; tooltip?: string } {
      if (value == null || !isFinite(value)) {
        return { text: '-', hasData: false, tooltip: tooltip ?? 'Data not available' };
      }
      return { text: formatter(value), hasData: true };
    }
    ```
    Keep the module-scope Intl.NumberFormat instances for performance.

    **src/lib/company-matching.ts:** Port from v1 (src/lib/company-matching.ts). The fuzzy matching logic that handles varied display names across data sources. Import COMPANY_IDS from types/company.ts and add a `normalizeCompanyId(rawId: string): string | null` function that maps variant company IDs from different JSON files (e.g., "Voltas Ltd" -> "voltas", "AMBER" -> "amber") to canonical IDs. This function is critical for DATA-04 (Pitfall 4 from research).

    **src/lib/source-utils.ts (new):** Create source tier determination helpers for SRCA-04:
    - `KNOWN_SOURCES` record mapping source name patterns to SourceInfo defaults (e.g., 'screener' -> { tier: 1, confidence: 'verified' }, 'trendlyne' -> { tier: 1, confidence: 'verified' }, 'sovrenn' -> { tier: 3, confidence: 'derived' }).
    - `getSourceForDataPoint(dataSource: string, lastUpdated: string): SourceInfo` — looks up source in KNOWN_SOURCES, returns appropriate SourceInfo. NEVER returns a filename as source — always the human-readable source name (SRCA-04).
    - `isHighConfidence(source: SourceInfo): boolean` — returns true for tier 1-2 with verified confidence.
    - `formatSourceDate(isoDate: string): string` — formats "2026-02-18" to "Feb 18, 2026".
  </action>
  <verify>
    Run `cd dashboard_build_v2 && npx tsc --noEmit` passes for all lib/ files.
    If v1 has tests for formatters and company-matching, port those too and run `cd dashboard_build_v2 && npx vitest run` to verify.
  </verify>
  <done>
    All utility libraries are created: formatters with safeDisplay for graceful degradation, company matching with ID normalization, source utils with tier determination helpers. Types are imported correctly from types/ directory.
  </done>
</task>

</tasks>

<verification>
1. `cd dashboard_build_v2 && npm install` completes successfully
2. `cd dashboard_build_v2 && npx tsc --noEmit` passes (with main.tsx temporarily simplified if App doesn't exist yet)
3. source-utils.ts NEVER maps to a filename — all sources are human-readable names
4. formatters.ts includes safeDisplay() function
5. company-matching.ts includes normalizeCompanyId() function
</verification>

<success_criteria>
- dashboard_build_v2/ is an installable, type-checkable project
- Vite config has @data alias for JSON imports and viteSingleFile for single-HTML output
- formatters.ts includes safeDisplay() for graceful degradation
- company-matching.ts includes normalizeCompanyId() for cross-source ID mapping
- source-utils.ts includes getSourceForDataPoint() that returns human-readable source names
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-infrastructure/01-01-SUMMARY.md`
</output>
