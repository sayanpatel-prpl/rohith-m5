---
phase: 04-section-group-b
plan: 04
type: execute
wave: 2
depends_on: ["04-01"]
files_modified:
  - dashboard_build_v2/src/sections/deep-dive/index.tsx
  - dashboard_build_v2/src/sections/deep-dive/SubSectorCards.tsx
  - dashboard_build_v2/src/sections/deep-dive/MarginLeversTable.tsx
  - dashboard_build_v2/src/sections/deep-dive/AMBenchmarkCallout.tsx
autonomous: true

must_haves:
  truths:
    - "User sees sub-sector breakdown cards with revenue growth, EBITDA margin, ROCE, and OPM quartiles per sub-sector"
    - "User sees Margin Levers Analysis table with 5 levers, applicable sub-sectors, evidence, and active companies"
    - "User sees A&M Benchmark Comparison callouts referencing European white goods and US consumer case studies"
    - "User sees chart source attribution visible on all data displays"
  artifacts:
    - path: "dashboard_build_v2/src/sections/deep-dive/index.tsx"
      provides: "Sub-Sector Deep Dive section main layout"
      min_lines: 50
    - path: "dashboard_build_v2/src/sections/deep-dive/SubSectorCards.tsx"
      provides: "Sub-sector breakdown cards with metrics and quartiles"
      min_lines: 50
    - path: "dashboard_build_v2/src/sections/deep-dive/MarginLeversTable.tsx"
      provides: "Margin Levers Analysis table with 5 levers"
      min_lines: 40
    - path: "dashboard_build_v2/src/sections/deep-dive/AMBenchmarkCallout.tsx"
      provides: "A&M benchmark comparison callout cards"
      min_lines: 25
  key_links:
    - from: "dashboard_build_v2/src/sections/deep-dive/index.tsx"
      to: "dashboard_build_v2/src/hooks/use-filtered-data.ts"
      via: "useFilteredData<DeepDiveData>('deep-dive')"
      pattern: "useFilteredData.*DeepDiveData.*deep-dive"
    - from: "dashboard_build_v2/src/sections/deep-dive/SubSectorCards.tsx"
      to: "dashboard_build_v2/src/types/deep-dive.ts"
      via: "SubSectorBreakdown type"
      pattern: "SubSectorBreakdown"
---

<objective>
Build the Sub-Sector Deep Dive section with sub-sector breakdown cards, margin levers analysis, and A&M benchmark comparisons.

Purpose: SSDD-01 (margin levers), SSDD-02 (A&M benchmarks), SSDD-03 (chart sources). Provides granular sub-sector intelligence to help A&M consultants identify which sub-sectors offer the best engagement opportunities.

Output: Fully functional Sub-Sector Deep Dive section with real data breakdowns and A&M case study references.
</objective>

<execution_context>
@C:/Users/rohit/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/rohit/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-section-group-b/04-01-SUMMARY.md
@dashboard_build_v2/src/types/deep-dive.ts
@dashboard_build_v2/src/sections/leadership/index.tsx
@dashboard_build_v2/src/hooks/use-filtered-data.ts
@dashboard_build_v2/src/components/ui/index.ts
@dashboard_build_v2/src/components/source/index.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Build SubSectorCards, MarginLeversTable, and AMBenchmarkCallout components</name>
  <files>
    dashboard_build_v2/src/sections/deep-dive/SubSectorCards.tsx
    dashboard_build_v2/src/sections/deep-dive/MarginLeversTable.tsx
    dashboard_build_v2/src/sections/deep-dive/AMBenchmarkCallout.tsx
  </files>
  <action>
**SubSectorCards.tsx** -- Sub-sector breakdown cards (SSDD-03 sources visible):
- Props: `{ subSectors: SubSectorBreakdown[] }`
- Render a responsive grid of cards (grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-md).
- Each card for a SubSectorBreakdown:
  - Header: subSector label (bold, text-base) + company count badge
  - Metrics grid (2x2 inside the card):
    - Avg Revenue Growth (formatted with +/- sign, colored positive/negative)
    - Avg EBITDA Margin (formatted 1 decimal + %)
    - Avg ROCE (formatted 1 decimal + %)
    - OPM Range: "P25: X% | Med: Y% | P75: Z%" (compact quartile display)
  - Top/Bottom performers: "Top: {name}" in green, "Bottom: {name}" in red/muted
  - Source attribution at bottom: small text showing "Source: Screener.in, Financial API" using SourceAttribution if available, or just text (SSDD-03).
  - Card styling: `bg-surface-raised border border-border-default rounded p-md`
  - Sort sub-sectors: AC first, then Kitchen, Electrical, EMS, Mixed, Cooler (logical grouping).

**MarginLeversTable.tsx** -- Margin Levers Analysis (SSDD-01):
- Props: `{ levers: MarginLever[] }`
- Render as an HTML table with columns: Lever | Applicable Sub-Sectors | Potential Impact | Current Evidence | Active Companies
- Lever column: display the lever name formatted nicely (replace hyphens with spaces, title case).
- Applicable Sub-Sectors: render as small badge pills for each sub-sector.
- Current Evidence: truncate to 150 chars with "..." if longer. If empty, show "-".
- Active Companies: show count + first 3 company names comma-separated, "+ N more" if more than 3.
- Table styling: `w-full text-xs`, same pattern as operations table. Wrap in overflow-x-auto.
- Below the table, add a small source attribution line: "Source: Sovrenn Intelligence growth triggers analysis | Tier 3" (SSDD-03).

**AMBenchmarkCallout.tsx** -- A&M Benchmark Comparison (SSDD-02):
- Props: `{ benchmarks: AMBenchmark[] }`
- Render each benchmark as a callout card with distinct A&M branding:
  - Use `bg-[color-mix(in_oklch,var(--color-brand-primary)_8%,transparent)]` background for A&M branding feel.
  - Left accent border: `border-l-4 border-brand-primary`.
  - Title (bold, text-sm) + Geography badge (small pill)
  - Metric highlight: large text showing value (e.g., "20%+" or "$150M") with metric label below
  - Detail paragraph (text-xs text-text-secondary)
  - Applicability line: italic text explaining relevance to Indian market
- Render 2 benchmark cards in a responsive grid (grid-cols-1 md:grid-cols-2 gap-md).
  </action>
  <verify>Run `npx tsc --noEmit --project dashboard_build_v2/tsconfig.json 2>&1 | grep -i "deep-dive/" | head -5` to confirm no type errors.</verify>
  <done>SubSectorCards displays per-sub-sector metrics with quartiles and source attribution. MarginLeversTable shows 5 margin levers with evidence and active companies. AMBenchmarkCallout renders 2 A&M case study reference cards with branding.</done>
</task>

<task type="auto">
  <name>Task 2: Wire Sub-Sector Deep Dive section index with all components</name>
  <files>
    dashboard_build_v2/src/sections/deep-dive/index.tsx
  </files>
  <action>
Replace the stub entirely. Follow the established section pattern:

1. Import useFilteredData, SectionSkeleton, DeepDiveData type.
2. Import local components: SubSectorCards, MarginLeversTable, AMBenchmarkCallout.
3. Loading/error/empty states same pattern as leadership/index.tsx.
4. Layout:
   a. Header: "Sub-Sector Deep Dive" with subtitle "Detailed analysis by sub-sector with margin levers and A&M benchmarks"
   b. SubSectorCards (full width) -- the primary data visualization
   c. MarginLeversTable (full width) -- SSDD-01 deliverable with section header "Margin Levers Analysis"
   d. AMBenchmarkCallout -- SSDD-02 deliverable with section header "A&M Benchmark Comparisons"
   e. Data freshness footer
5. Each sub-section (cards, table, benchmarks) wrapped with a sub-header:
   - `<h3 className="text-base font-semibold text-text-primary">Sub-Sector title</h3>`
   - Consistent spacing with `space-y-sm` within each sub-section.
6. Remove unused NewsItem import and _newsItems variable from the stub.
7. The section uses `useFilteredData<DeepDiveData>("deep-dive")`.
  </action>
  <verify>Run `npx tsc --noEmit --project dashboard_build_v2/tsconfig.json 2>&1 | head -20`. Run `npm run build --prefix dashboard_build_v2 2>&1 | tail -5`. Check that the old stub content is fully replaced.</verify>
  <done>Sub-Sector Deep Dive renders sub-sector breakdown cards, margin levers table (SSDD-01), and A&M benchmark callouts (SSDD-02). All data displays have visible source attribution (SSDD-03). No mock data references.</done>
</task>

</tasks>

<verification>
1. TypeScript compiles with no errors
2. Build succeeds
3. Deep Dive section renders at /:tenant/report/deep-dive
4. Sub-sector cards show metrics for each of the 6 sub-sectors with quartile data
5. Margin Levers table shows 5 levers with real evidence from Sovrenn data (SSDD-01)
6. A&M Benchmark callouts show European white goods and US consumer references (SSDD-02)
7. All charts/tables have visible source attribution (SSDD-03)
</verification>

<success_criteria>
- Sub-sector breakdown visible with per-sector metrics and OPM quartiles
- 5 margin levers displayed with applicable sub-sectors and real data evidence (SSDD-01)
- 2 A&M benchmark comparison cards with case study details (SSDD-02)
- Source attribution visible on every data component (SSDD-03)
- Section follows established layout pattern
</success_criteria>

<output>
After completion, create `.planning/phases/04-section-group-b/04-04-SUMMARY.md`
</output>
