---
phase: 04-section-group-b
plan: 03
type: execute
wave: 2
depends_on: ["04-01"]
files_modified:
  - dashboard_build_v2/src/sections/competitive/index.tsx
  - dashboard_build_v2/src/sections/competitive/CompetitiveHeatmap.tsx
  - dashboard_build_v2/src/sections/competitive/MoveCard.tsx
  - dashboard_build_v2/src/sections/competitive/MoveSummaryStats.tsx
autonomous: true

must_haves:
  truths:
    - "User sees competitive moves populated from real Sovrenn data with source attribution"
    - "User sees a Competitive Intensity Heatmap showing Company x Move Type matrix colored by frequency"
    - "User sees cross-link indicators on moves with operational implications"
    - "User can filter moves by type"
  artifacts:
    - path: "dashboard_build_v2/src/sections/competitive/index.tsx"
      provides: "Competitive Moves section main layout"
      min_lines: 50
    - path: "dashboard_build_v2/src/sections/competitive/CompetitiveHeatmap.tsx"
      provides: "Competitive Intensity Heatmap component"
      min_lines: 40
    - path: "dashboard_build_v2/src/sections/competitive/MoveCard.tsx"
      provides: "Individual competitive move card"
      min_lines: 25
    - path: "dashboard_build_v2/src/sections/competitive/MoveSummaryStats.tsx"
      provides: "Summary stats for competitive section"
      min_lines: 15
  key_links:
    - from: "dashboard_build_v2/src/sections/competitive/index.tsx"
      to: "dashboard_build_v2/src/hooks/use-filtered-data.ts"
      via: "useFilteredData<CompetitiveData>('competitive')"
      pattern: "useFilteredData.*CompetitiveData.*competitive"
    - from: "dashboard_build_v2/src/sections/competitive/CompetitiveHeatmap.tsx"
      to: "dashboard_build_v2/src/types/competitive.ts"
      via: "CompetitiveIntensityRow type"
      pattern: "CompetitiveIntensityRow"
---

<objective>
Build the Competitive Moves & Strategic Bets section with real data, competitive intensity heatmap, and cross-links to Operations.

Purpose: COMP-01 (real data), COMP-02 (intensity heatmap), COMP-03 (cross-links). Shows A&M consultants how companies are competing and where competitive moves create operational advisory opportunities.

Output: Fully functional Competitive Moves section with heatmap visualization and move timeline.
</objective>

<execution_context>
@C:/Users/rohit/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/rohit/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-section-group-b/04-01-SUMMARY.md
@dashboard_build_v2/src/types/competitive.ts
@dashboard_build_v2/src/sections/deals/index.tsx
@dashboard_build_v2/src/sections/deals/DealCard.tsx
@dashboard_build_v2/src/hooks/use-filtered-data.ts
@dashboard_build_v2/src/components/ui/index.ts
@dashboard_build_v2/src/components/source/index.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Build CompetitiveHeatmap and MoveCard components</name>
  <files>
    dashboard_build_v2/src/sections/competitive/CompetitiveHeatmap.tsx
    dashboard_build_v2/src/sections/competitive/MoveCard.tsx
    dashboard_build_v2/src/sections/competitive/MoveSummaryStats.tsx
  </files>
  <action>
**CompetitiveHeatmap.tsx** -- Competitive Intensity Heatmap (COMP-02):
- Props: `{ matrix: CompetitiveIntensityRow[] }`
- Render as an HTML table grid: rows = companies (sorted by totalMoves desc), columns = move types.
- Column headers: map MoveType values to short display labels: "Cap Exp" | "New Prod" | "Acq" | "Partner" | "Geo" | "Tech" | "Pricing" | "Other" | "Total"
- Each cell contains the count number. Cell background color intensity based on count using inline style with color-mix:
  - 0 moves: transparent (no background)
  - 1 move: `color-mix(in oklch, var(--color-brand-primary) 15%, transparent)`
  - 2 moves: `color-mix(in oklch, var(--color-brand-primary) 30%, transparent)`
  - 3+ moves: `color-mix(in oklch, var(--color-brand-primary) 50%, transparent)`
- First column is company name (left-aligned, text-xs font-medium), rest are centered numbers.
- Total column at end with font-semibold.
- Table styling: `w-full text-xs border-collapse`, headers `bg-surface-overlay text-[10px] text-text-secondary px-1.5 py-1`, cells `px-1.5 py-1 text-center border border-border-default`.
- Wrap in overflow-x-auto for mobile.

**MoveCard.tsx** -- Individual competitive move card:
- Props: `{ move: CompetitiveMove }`
- Card layout similar to DealCard.tsx pattern:
  - Top row: Company name (bold) + MoveType badge (small colored pill, use inline style for color)
  - Description text (text-sm, text-text-secondary)
  - Bottom row: date + source attribution via SourceAttribution component
  - If move.hasOperationalImplication is true, show a small "Ops Link" badge with `text-[var(--color-warning)]` and italic text of operationalImplication (COMP-03).
- MoveType badge colors (use inline style with oklch color-mix similar to AMServiceLineTag):
  - capacity-expansion: brand-primary
  - acquisition: var(--color-am-transaction)
  - technology: var(--color-am-improvement)
  - new-product: var(--color-positive)
  - geographic: var(--color-info, blue fallback)
  - partnership: var(--color-am-neutral)
  - pricing: var(--color-warning)
  - other: var(--color-text-muted)
- Card wrapper: `bg-surface-raised border border-border-default rounded p-sm`

**MoveSummaryStats.tsx** -- Summary statistics:
- Props: `{ stats: CompetitiveSummaryStats }`
- Grid of 4 stat cards (same inline StatCard pattern as leadership/index.tsx):
  - Total Moves, Active Companies, Dominant Move Type, Avg Moves/Company (1 decimal)
  </action>
  <verify>Run `npx tsc --noEmit --project dashboard_build_v2/tsconfig.json 2>&1 | grep -i "competitive/" | head -5` to confirm no type errors.</verify>
  <done>CompetitiveHeatmap renders company x move-type matrix with color-coded intensity cells. MoveCard shows individual moves with operational implication badges. MoveSummaryStats displays 4 key metrics.</done>
</task>

<task type="auto">
  <name>Task 2: Wire Competitive Moves section index with heatmap and move timeline</name>
  <files>
    dashboard_build_v2/src/sections/competitive/index.tsx
  </files>
  <action>
Replace the stub entirely. Follow the same pattern as deals/index.tsx:

1. Import useFilteredData, SectionSkeleton, CompetitiveData type.
2. Import local components: CompetitiveHeatmap, MoveCard, MoveSummaryStats.
3. Add local state for move type filter (useState<MoveType | "all">("all")).
4. Loading/error/empty states same pattern as deals/index.tsx.
5. Layout:
   a. Header: "Competitive Moves & Strategic Bets" with subtitle "Strategic positioning, market share dynamics, and competitive intelligence"
   b. MoveSummaryStats row
   c. CompetitiveHeatmap (full width) -- this is the key COMP-02 deliverable
   d. Move type filter bar: "All" + one button per MoveType that has at least 1 move, with count in parentheses. Same filter pill styling as deals/index.tsx.
   e. Move cards in a 2-column grid (md:grid-cols-2), showing filtered moves. If no moves, show italic empty state message.
   f. Data freshness footer
6. Remove unused NewsItem import and _newsItems variable from the stub.
7. The section uses `useFilteredData<CompetitiveData>("competitive")`.
8. For COMP-03 cross-links: moves with hasOperationalImplication already show "Ops Link" badge via MoveCard. Additionally, if data.crossLinkOperationsIds has entries, add a small note below the heatmap: "N companies have moves with operational implications -- see Operational Intelligence section."
  </action>
  <verify>Run `npx tsc --noEmit --project dashboard_build_v2/tsconfig.json 2>&1 | head -20`. Run `npm run build --prefix dashboard_build_v2 2>&1 | tail -5`. Check that the old stub content is fully replaced.</verify>
  <done>Competitive Moves section renders with summary stats, intensity heatmap (COMP-02), filterable move cards from real Sovrenn data (COMP-01), and cross-link indicators to Operations (COMP-03). No mock data references.</done>
</task>

</tasks>

<verification>
1. TypeScript compiles with no errors
2. Build succeeds
3. Competitive section renders at /:tenant/report/competitive
4. Heatmap shows Company x MoveType matrix with color-coded cells (COMP-02)
5. Move cards sourced from real Sovrenn data with source attribution (COMP-01)
6. Moves with operational implications have "Ops Link" badge (COMP-03)
7. Type filter works to narrow displayed moves
</verification>

<success_criteria>
- Competitive Intensity Heatmap visible with companies as rows, move types as columns (COMP-02)
- Every move card has source attribution -- no mock-data (COMP-01)
- Cross-links to Operations visible on moves with operational implications (COMP-03)
- Filter bar lets user narrow by move type
- Section follows established layout pattern
</success_criteria>

<output>
After completion, create `.planning/phases/04-section-group-b/04-03-SUMMARY.md`
</output>
