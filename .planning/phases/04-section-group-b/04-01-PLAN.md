---
phase: 04-section-group-b
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - dashboard_build_v2/src/types/operations.ts
  - dashboard_build_v2/src/types/competitive.ts
  - dashboard_build_v2/src/types/deep-dive.ts
  - dashboard_build_v2/src/data/adapters/operations-adapter.ts
  - dashboard_build_v2/src/data/adapters/competitive-adapter.ts
  - dashboard_build_v2/src/data/adapters/deep-dive-adapter.ts
  - dashboard_build_v2/src/api/queries.ts
autonomous: true

must_haves:
  truths:
    - "Operations adapter returns typed OperationsData with per-metric confidence levels and A&M diagnostic triggers"
    - "Competitive adapter returns typed CompetitiveData with company moves extracted from real Sovrenn data and intensity matrix"
    - "Deep Dive adapter returns typed DeepDiveData with margin levers by sub-sector and A&M benchmark comparisons"
    - "All three query factories in queries.ts call their respective adapters instead of generic buildSectionData"
  artifacts:
    - path: "dashboard_build_v2/src/types/operations.ts"
      provides: "OperationsData, OpsMetricRow, ConfidenceIcon, DiagnosticTrigger types"
      contains: "OperationsData extends SectionData"
    - path: "dashboard_build_v2/src/types/competitive.ts"
      provides: "CompetitiveData, CompetitiveMove, IntensityCell types"
      contains: "CompetitiveData extends SectionData"
    - path: "dashboard_build_v2/src/types/deep-dive.ts"
      provides: "DeepDiveData, MarginLever, SubSectorBreakdown, AMBenchmark types"
      contains: "DeepDiveData extends SectionData"
    - path: "dashboard_build_v2/src/data/adapters/operations-adapter.ts"
      provides: "buildOperationsData function"
      exports: ["buildOperationsData"]
    - path: "dashboard_build_v2/src/data/adapters/competitive-adapter.ts"
      provides: "buildCompetitiveData function"
      exports: ["buildCompetitiveData"]
    - path: "dashboard_build_v2/src/data/adapters/deep-dive-adapter.ts"
      provides: "buildDeepDiveData function"
      exports: ["buildDeepDiveData"]
    - path: "dashboard_build_v2/src/api/queries.ts"
      provides: "Updated query factories for operations, competitive, deep-dive"
  key_links:
    - from: "dashboard_build_v2/src/api/queries.ts"
      to: "dashboard_build_v2/src/data/adapters/operations-adapter.ts"
      via: "import buildOperationsData"
      pattern: "buildOperationsData"
    - from: "dashboard_build_v2/src/api/queries.ts"
      to: "dashboard_build_v2/src/data/adapters/competitive-adapter.ts"
      via: "import buildCompetitiveData"
      pattern: "buildCompetitiveData"
    - from: "dashboard_build_v2/src/api/queries.ts"
      to: "dashboard_build_v2/src/data/adapters/deep-dive-adapter.ts"
      via: "import buildDeepDiveData"
      pattern: "buildDeepDiveData"
---

<objective>
Create TypeScript types and data adapters for all 3 Phase 4 sections (Operations, Competitive, Sub-Sector Deep Dive), then wire them into the query factory registry.

Purpose: Establishes the complete data layer for Phase 4, enabling Wave 2 UI plans to consume typed data via useFilteredData<T>(sectionId). Follows the established adapter pattern from Phases 2-3.

Output: 3 type files, 3 adapter files, updated queries.ts -- all section UIs can immediately consume real data.
</objective>

<execution_context>
@C:/Users/rohit/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/rohit/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@dashboard_build_v2/src/types/sections.ts
@dashboard_build_v2/src/types/source.ts
@dashboard_build_v2/src/types/common.ts
@dashboard_build_v2/src/types/am-theme.ts
@dashboard_build_v2/src/types/company.ts
@dashboard_build_v2/src/data/loaders/consolidated.ts
@dashboard_build_v2/src/data/loaders/sovrenn.ts
@dashboard_build_v2/src/data/loaders/financial-api.ts
@dashboard_build_v2/src/data/loaders/trendlyne.ts
@dashboard_build_v2/src/data/loaders/screener.ts
@dashboard_build_v2/src/data/companies.ts
@dashboard_build_v2/src/data/adapters/leadership-adapter.ts
@dashboard_build_v2/src/data/adapters/market-pulse-adapter.ts
@dashboard_build_v2/src/data/adapters/deals-adapter.ts
@dashboard_build_v2/src/api/queries.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create type definitions for Operations, Competitive, and Deep Dive sections</name>
  <files>
    dashboard_build_v2/src/types/operations.ts
    dashboard_build_v2/src/types/competitive.ts
    dashboard_build_v2/src/types/deep-dive.ts
  </files>
  <action>
Create 3 type files following the exact pattern used in types/leadership.ts and types/market-pulse.ts (import SectionData, SourceInfo, AMServiceLine as needed).

**dashboard_build_v2/src/types/operations.ts** -- OperationsData extends SectionData:
- `ConfidenceIcon`: type union `"verified" | "derived" | "estimated"` (maps to checkmark/~/? icons in UI per OPER-01)
- `OpsMetricRow`: per-company row with fields: companyId, company, subSector, revenueGrowthPct, ebitdaMarginPct, opmPct, rocePct, workingCapitalDays, debtEquity, inventoryDays, debtorDays, cashConversionCycle. Each numeric field has a parallel `{field}Confidence: ConfidenceIcon` field. Also include `source: SourceInfo`.
- `DiagnosticTrigger`: { companyId, company, trigger: string (human-readable), metric: string, value: number, threshold: number, amServiceLine: AMServiceLine, source: SourceInfo } -- for OPER-02 A&M Operations Diagnostic Triggers
- `OperationsSummaryStats`: { companiesTracked: number, avgEbitdaMargin: number, avgROCE: number, diagnosticTriggerCount: number }
- `OperationsData`: extends SectionData with { summaryStats, metrics: OpsMetricRow[], diagnosticTriggers: DiagnosticTrigger[], crossLinkCompetitiveIds: string[] }

**dashboard_build_v2/src/types/competitive.ts** -- CompetitiveData extends SectionData:
- `MoveType`: type union `"capacity-expansion" | "new-product" | "acquisition" | "partnership" | "geographic" | "technology" | "pricing" | "other"`
- `CompetitiveMove`: { id, companyId, company, moveType: MoveType, moveTypeLabel: string, description: string, date: string, dateISO: string, hasOperationalImplication: boolean, operationalImplication?: string, source: SourceInfo }
- `IntensityCell`: { companyId, company, moveType: MoveType, count: number } -- for heatmap grid
- `CompetitiveIntensityRow`: { companyId, company, moveCounts: Record<MoveType, number>, totalMoves: number } -- row for heatmap
- `CompetitiveSummaryStats`: { totalMoves: number, activeCompanies: number, dominantMoveType: string, avgMovesPerCompany: number }
- `CompetitiveData`: extends SectionData with { summaryStats, moves: CompetitiveMove[], intensityMatrix: CompetitiveIntensityRow[], crossLinkOperationsIds: string[] }

**dashboard_build_v2/src/types/deep-dive.ts** -- DeepDiveData extends SectionData:
- `SubSectorId`: type matching company.ts subSector: `"AC" | "Kitchen" | "Electrical" | "EMS" | "Mixed" | "Cooler"`
- `MarginLever`: { lever: string (premiumization | backward-integration | distribution-rationalization | vendor-consolidation | sku-rationalization), applicableSubSectors: SubSectorId[], potentialImpact: string, currentEvidence: string, companiesActive: string[], source: SourceInfo }
- `SubSectorBreakdown`: { subSector: SubSectorId, label: string, companyCount: number, avgRevenueGrowth: number, avgEbitdaMargin: number, avgROCE: number, topPerformer: string, bottomPerformer: string, opmQuartiles: { p25: number, median: number, p75: number }, revenueQuartiles: { p25: number, median: number, p75: number }, source: SourceInfo }
- `AMBenchmark`: { title: string, geography: string, metric: string, value: string, detail: string, applicability: string } -- for SSDD-02 A&M case study references
- `DeepDiveData`: extends SectionData with { subSectors: SubSectorBreakdown[], marginLevers: MarginLever[], amBenchmarks: AMBenchmark[] }
  </action>
  <verify>Run `npx tsc --noEmit --project dashboard_build_v2/tsconfig.json 2>&1 | head -20` to confirm no type errors in the new files. Check each file exists and exports its main interface.</verify>
  <done>3 type definition files exist with all required interfaces. No TypeScript compilation errors from these files. Types follow the established SectionData extension pattern.</done>
</task>

<task type="auto">
  <name>Task 2: Create data adapters for all 3 sections and wire into queries.ts</name>
  <files>
    dashboard_build_v2/src/data/adapters/operations-adapter.ts
    dashboard_build_v2/src/data/adapters/competitive-adapter.ts
    dashboard_build_v2/src/data/adapters/deep-dive-adapter.ts
    dashboard_build_v2/src/api/queries.ts
  </files>
  <action>
Create 3 adapter files following the exact pattern of leadership-adapter.ts and market-pulse-adapter.ts. Each adapter: imports loaders (consolidated, sovrenn, financial-api, trendlyne), builds company bundles, returns typed section data. Never fabricates data -- missing values are null/empty arrays.

**dashboard_build_v2/src/data/adapters/operations-adapter.ts** -- `buildOperationsData(): OperationsData`:
1. Import getConsolidatedData, getFinancialApiData, getSovrennData, getTrendlyneData, getCompanyById.
2. Build bundles combining all 4 loader sources per company ID (same pattern as leadership-adapter buildBundles).
3. For each company, build an OpsMetricRow:
   - revenueGrowthPct from financial-api metrics.revenueGrowth (confidence: "verified")
   - ebitdaMarginPct from financial-api metrics.ebitdaMargin (confidence: "verified")
   - opmPct from latest consolidated quarterly result opmPct (confidence: "verified")
   - rocePct from consolidated overview.roce OR trendlyne keyRatios.roce_pct (confidence: "verified" if consolidated, "derived" if trendlyne)
   - workingCapitalDays from financial-api metrics.workingCapitalDays (confidence: "verified")
   - debtEquity from financial-api metrics.debtEquity (confidence: "verified")
   - inventoryDays from consolidated ratios (latest period) "Inventory Days" (confidence: "verified"), fallback 0 with "estimated"
   - debtorDays from consolidated ratios "Debtor Days" (confidence: "verified"), fallback 0 with "estimated"
   - cashConversionCycle from consolidated ratios "Cash Conversion Cycle" (confidence: "verified"), fallback 0 with "estimated"
   - subSector from company registry
4. Build diagnostic triggers (OPER-02) -- scan each company for:
   - OPM < 5% => "Low operating margin indicates potential operational inefficiency" (threshold: 5, A&M: "Operations")
   - Working Capital Days > 120 => "High working capital days suggest cash conversion cycle issues" (threshold: 120, A&M: "CPI")
   - Debt/Equity > 1.5 => "Elevated leverage may constrain operational flexibility" (threshold: 1.5, A&M: "Restructuring")
   - ROCE < 8% => "Low ROCE signals poor capital allocation efficiency" (threshold: 8, A&M: "CPI")
   - Revenue Growth < -10% => "Significant revenue decline warrants turnaround assessment" (threshold: -10, A&M: "Restructuring")
   - These map to the A&M Operations Diagnostic Triggers concept from OPER-02 (capacity util proxy via OPM, cost structure via working capital, leverage).
5. crossLinkCompetitiveIds: collect company IDs from diagnostic triggers (companies needing attention likely have competitive move implications).
6. Compute summaryStats.

**dashboard_build_v2/src/data/adapters/competitive-adapter.ts** -- `buildCompetitiveData(): CompetitiveData`:
1. Import getSovrennData, getCompanyById. Competitive moves are extracted from Sovrenn growth triggers AND deal activity (COMP-01: real data only).
2. For each sovrenn company, classify growth triggers into MoveType categories:
   - /capacity|plant|facility|greenfield|manufacturing/ => "capacity-expansion"
   - /new.*product|launch|range|model|SKU/ => "new-product"
   - /acqui|bought|acquired|merger/ => "acquisition"
   - /partner|jv|joint venture|collaboration|alliance/ => "partnership"
   - /international|export|global|overseas|foreign market/ => "geographic"
   - /technology|digital|automation|AI|IoT|R&D|innovation/ => "technology"
   - /pricing|price|cost.*leader|premium/ => "pricing"
   - Otherwise => "other"
   Each matched trigger becomes a CompetitiveMove with description from the trigger text, date from sovrenn lastUpdated or "FY2026", hasOperationalImplication = true if moveType is "capacity-expansion" or "technology" (COMP-03 cross-link).
3. Also scan sovrenn dealActivity for competitive moves: acquisitions and investments are "acquisition" moves, land-allotment is "capacity-expansion". Filter out quarterly results same as deals-adapter does.
4. Build intensityMatrix: for each company, count moves per MoveType as CompetitiveIntensityRow. Sort by totalMoves descending.
5. crossLinkOperationsIds: collect company IDs where hasOperationalImplication is true.
6. Compute summaryStats.
7. Sort moves by dateISO descending.

**dashboard_build_v2/src/data/adapters/deep-dive-adapter.ts** -- `buildDeepDiveData(): DeepDiveData`:
1. Import getConsolidatedData, getFinancialApiData, getCompanyById, COMPANIES from companies.ts.
2. Group all companies by subSector from the company registry.
3. For each sub-sector group, compute SubSectorBreakdown:
   - avgRevenueGrowth: average of financial-api metrics.revenueGrowth for companies in group
   - avgEbitdaMargin: average of financial-api metrics.ebitdaMargin
   - avgROCE: average of consolidated overview.roce
   - topPerformer: company with highest revenueGrowth
   - bottomPerformer: company with lowest revenueGrowth
   - opmQuartiles: compute P25/median/P75 from all companies' latest opmPct (consolidated quarterly results)
   - revenueQuartiles: compute from financial-api revenue values (latest)
   - Source: screenerSource (tier 1)
4. Build marginLevers array (SSDD-01) -- 5 known levers with real data evidence:
   - "premiumization": applicableSubSectors ["AC", "Kitchen", "Electrical"], scan sovrenn triggers for premium/brand/high-end keywords, list companies with evidence
   - "backward-integration": applicable ["AC", "EMS"], scan for PCB/component/backward-integration/in-house, list companies
   - "distribution-rationalization": applicable all, scan for distribution/channel/retail/D2C
   - "vendor-consolidation": applicable ["EMS", "Electrical"], scan for vendor/consolidat/supply chain/sourcing
   - "sku-rationalization": applicable ["Kitchen", "Electrical", "Mixed"], scan for SKU/portfolio/rationaliz/prune
   Each lever's potentialImpact: descriptive string. currentEvidence: join matched trigger texts.
5. Build amBenchmarks array (SSDD-02) -- 2 static entries:
   - { title: "European White Goods Restructuring", geography: "Europe", metric: "EBITDA Margin Uplift", value: "20%+", detail: "A&M-led operational restructuring of European white goods manufacturer achieved 20%+ EBITDA margin improvement through procurement optimization, plant consolidation, and SKU rationalization.", applicability: "Directly applicable to Indian Kitchen and Electrical sub-sectors facing similar margin compression." }
   - { title: "US Consumer Durables Operational Turnaround", geography: "United States", metric: "EBITDA Improvement", value: "$150M", detail: "A&M delivered $150M EBITDA improvement for a major US consumer products company through supply chain redesign, manufacturing footprint optimization, and working capital reduction.", applicability: "Relevant for Indian AC and EMS companies expanding capacity -- operational excellence framework transferable." }

**dashboard_build_v2/src/api/queries.ts** -- Update 3 query factories:
- Import buildOperationsData, buildCompetitiveData, buildDeepDiveData from their adapter files.
- Replace `buildSectionData("operations")` with `buildOperationsData()` in the operations factory.
- Replace `buildSectionData("competitive")` with `buildCompetitiveData()` in the competitive factory.
- Replace `buildSectionData("deep-dive")` with `buildDeepDiveData()` in the deep-dive factory.
  </action>
  <verify>Run `npx tsc --noEmit --project dashboard_build_v2/tsconfig.json 2>&1 | head -30` to confirm no type errors. Then run `npm run build --prefix dashboard_build_v2 2>&1 | tail -5` to verify build succeeds. Check that queries.ts no longer references buildSectionData for operations, competitive, or deep-dive.</verify>
  <done>3 adapter files exist and export build functions. queries.ts imports all 3 adapters and uses them in query factories. TypeScript compiles cleanly. Build succeeds.</done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit --project dashboard_build_v2/tsconfig.json` passes with no new errors
2. `npm run build --prefix dashboard_build_v2` completes successfully
3. All 3 type files export their main interface (OperationsData, CompetitiveData, DeepDiveData)
4. All 3 adapters export their build function
5. queries.ts references all 3 adapter build functions
6. No mock data references in any adapter -- all data from loaders
</verification>

<success_criteria>
- OperationsData type has OpsMetricRow with per-field confidence, DiagnosticTrigger with A&M service line
- CompetitiveData type has CompetitiveMove from real Sovrenn data, IntensityMatrix for heatmap
- DeepDiveData type has SubSectorBreakdown with quartiles, MarginLever with evidence, AMBenchmark
- All 3 sections wired in queries.ts to their adapters
- Zero fabricated data -- all values from consolidated/financial-api/sovrenn/trendlyne loaders or marked with appropriate confidence level
</success_criteria>

<output>
After completion, create `.planning/phases/04-section-group-b/04-01-SUMMARY.md`
</output>
