---
phase: 04-section-group-b
plan: 02
type: execute
wave: 2
depends_on: ["04-01"]
files_modified:
  - dashboard_build_v2/src/sections/operations/index.tsx
  - dashboard_build_v2/src/sections/operations/OpsMetricsTable.tsx
  - dashboard_build_v2/src/sections/operations/DiagnosticTriggers.tsx
  - dashboard_build_v2/src/sections/operations/ConfidenceIcon.tsx
  - dashboard_build_v2/src/sections/operations/MethodologyTooltip.tsx
autonomous: true

must_haves:
  truths:
    - "User sees a sortable metrics table with per-cell confidence indicators (checkmark/~/?) and tooltips explaining data source"
    - "User sees an A&M Operations Diagnostic Triggers card listing companies exceeding operational thresholds"
    - "User sees summary stats (companies tracked, avg EBITDA margin, avg ROCE, diagnostic trigger count)"
    - "User sees cross-link badges on companies that also appear in Competitive Moves"
    - "User sees methodology tooltips on derived metrics (market share proxy, operational efficiency)"
  artifacts:
    - path: "dashboard_build_v2/src/sections/operations/index.tsx"
      provides: "Operations section main layout"
      min_lines: 50
    - path: "dashboard_build_v2/src/sections/operations/OpsMetricsTable.tsx"
      provides: "Per-company metrics table with confidence icons per cell"
      min_lines: 80
    - path: "dashboard_build_v2/src/sections/operations/DiagnosticTriggers.tsx"
      provides: "A&M Diagnostic Triggers card"
      min_lines: 30
    - path: "dashboard_build_v2/src/sections/operations/ConfidenceIcon.tsx"
      provides: "Reusable confidence icon component with tooltip"
      min_lines: 15
    - path: "dashboard_build_v2/src/sections/operations/MethodologyTooltip.tsx"
      provides: "Methodology tooltip for derived metrics column headers"
      min_lines: 15
  key_links:
    - from: "dashboard_build_v2/src/sections/operations/index.tsx"
      to: "dashboard_build_v2/src/hooks/use-filtered-data.ts"
      via: "useFilteredData<OperationsData>('operations')"
      pattern: "useFilteredData.*OperationsData.*operations"
    - from: "dashboard_build_v2/src/sections/operations/OpsMetricsTable.tsx"
      to: "dashboard_build_v2/src/sections/operations/ConfidenceIcon.tsx"
      via: "import ConfidenceIcon"
      pattern: "ConfidenceIcon"
---

<objective>
Build the Operational Intelligence section UI with a metrics table featuring per-cell confidence indicators, A&M diagnostic triggers card, and cross-links to Competitive Moves.

Purpose: OPER-01 (confidence icons), OPER-02 (A&M diagnostic triggers), OPER-03 (cross-links). This is the primary operational analysis view for A&M consultants to identify companies with operational improvement opportunities.

Output: Fully functional Operations section consuming real data via useFilteredData<OperationsData>.
</objective>

<execution_context>
@C:/Users/rohit/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/rohit/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-section-group-b/04-01-SUMMARY.md
@dashboard_build_v2/src/types/operations.ts
@dashboard_build_v2/src/sections/leadership/index.tsx
@dashboard_build_v2/src/sections/leadership/GovernanceRiskScoring.tsx
@dashboard_build_v2/src/hooks/use-filtered-data.ts
@dashboard_build_v2/src/components/ui/index.ts
@dashboard_build_v2/src/components/source/index.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Build reusable ConfidenceIcon and MethodologyTooltip components</name>
  <files>
    dashboard_build_v2/src/sections/operations/ConfidenceIcon.tsx
    dashboard_build_v2/src/sections/operations/MethodologyTooltip.tsx
  </files>
  <action>
**ConfidenceIcon.tsx** -- Small inline component for OPER-01 per-cell confidence indicators:
- Props: `{ confidence: ConfidenceIcon type from operations.ts }`
- Renders inline next to a numeric value:
  - "verified" => green checkmark character (Unicode 2713) with `text-[var(--color-positive)]`, title tooltip "Verified: directly from financial filings"
  - "derived" => tilde ~ with `text-[var(--color-warning)]`, title tooltip "Derived: calculated from multiple sources"
  - "estimated" => question mark ? with `text-[var(--color-text-muted)]`, title tooltip "Estimated: proxy or inferred value"
- Use native `title` attribute for tooltips (POC quality, no tooltip library needed).
- Component is a span element with `text-[10px] ml-0.5 cursor-help` classes.

**MethodologyTooltip.tsx** -- Column header tooltip for derived metrics:
- Props: `{ label: string, methodology: string }`
- Renders the label text with a small info icon (Unicode 2139 or "i" in a circle) next to it.
- On hover (CSS group/group-hover pattern from 02-02), shows a small absolute-positioned tooltip with the methodology text.
- Use the same Tailwind group-hover pattern established in Executive Snapshot: wrap in a `relative group` div, tooltip is `absolute hidden group-hover:block` with z-10.
- Keep it compact: tooltip max-w-xs, text-[10px], bg-surface-overlay, border, rounded, p-1.5.
  </action>
  <verify>Check that both files export named components. Run `npx tsc --noEmit --project dashboard_build_v2/tsconfig.json 2>&1 | grep -i "operations/" | head -5` to confirm no type errors in these files.</verify>
  <done>ConfidenceIcon renders 3 visual states (checkmark/tilde/question) with native title tooltips. MethodologyTooltip shows info-icon hover tooltip for column headers.</done>
</task>

<task type="auto">
  <name>Task 2: Build OpsMetricsTable, DiagnosticTriggers, and wire Operations section index</name>
  <files>
    dashboard_build_v2/src/sections/operations/OpsMetricsTable.tsx
    dashboard_build_v2/src/sections/operations/DiagnosticTriggers.tsx
    dashboard_build_v2/src/sections/operations/index.tsx
  </files>
  <action>
**OpsMetricsTable.tsx** -- Main metrics table component (OPER-01):
- Props: `{ metrics: OpsMetricRow[], crossLinkCompetitiveIds: string[] }`
- Use a standard HTML table (not DataTable -- this needs per-cell confidence icons which DataTable doesn't support).
- Columns: Company | Sub-Sector | Rev Growth% | EBITDA Margin% | OPM% | ROCE% | WC Days | D/E | Inv Days | Debtor Days | CCC
- Each numeric cell renders the value formatted (1 decimal) plus a ConfidenceIcon component next to it using the parallel confidence field.
- Column headers for derived metrics (ROCE if from trendlyne, CCC) use MethodologyTooltip:
  - ROCE: "Return on Capital Employed. Primary source: Screener.in financial statements. Fallback: Trendlyne key ratios."
  - CCC: "Cash Conversion Cycle = Inventory Days + Debtor Days - Days Payable. Source: Screener.in ratio analysis."
- If company ID is in crossLinkCompetitiveIds array, show a small link icon or "(C)" badge next to company name indicating cross-link to Competitive Moves section (OPER-03).
- Table styling: `w-full text-xs`, header row `bg-surface-overlay text-text-secondary font-medium`, alternating row backgrounds `even:bg-surface-raised`, cells `px-2 py-1.5 text-right` (except company name left-aligned).
- Sort by company name alphabetically by default.

**DiagnosticTriggers.tsx** -- A&M Operations Diagnostic card (OPER-02):
- Props: `{ triggers: DiagnosticTrigger[] }`
- Render a card with header "A&M Operations Diagnostic Triggers" and an AMServiceLineTag icon.
- If triggers.length === 0, show "No diagnostic triggers detected -- all companies within operational norms."
- Otherwise, list each trigger as a row: company name, trigger description, metric value vs threshold, AMServiceLineTag showing the service line.
- Group by trigger type or just list flat. Each row has: company name (bold), trigger text (regular), metric badge showing "value vs threshold" with red/amber coloring.
- Use existing AMServiceLineTag component from @/components/source for service line badges.
- Card uses `bg-surface-raised border border-border-default rounded p-md` wrapper.

**index.tsx** -- Replace the stub with the full Operations section:
- Pattern: same as leadership/index.tsx -- useFilteredData<OperationsData>("operations"), loading/error states, destructure data.
- Layout:
  1. Header with title "Operational Intelligence" and subtitle
  2. Summary stats row (4 StatCard-style inline cards): Companies Tracked, Avg EBITDA Margin (%), Avg ROCE (%), Diagnostic Triggers
  3. OpsMetricsTable (full width, scrollable on mobile via overflow-x-auto wrapper)
  4. DiagnosticTriggers card below the table
  5. Data freshness footer
- Import StatCard pattern inline (same approach as leadership/index.tsx -- local StatCard function, not the global one, to keep section self-contained).
- Remove the old stub content entirely. Remove the unused NewsItem import.
  </action>
  <verify>Run `npx tsc --noEmit --project dashboard_build_v2/tsconfig.json 2>&1 | head -20` for type check. Run `npm run build --prefix dashboard_build_v2 2>&1 | tail -5` for build success. Visually confirm the section renders by checking the dev server at the operations route.</verify>
  <done>Operations section displays sortable metrics table with per-cell confidence icons (OPER-01), A&M Diagnostic Triggers card (OPER-02), and cross-link indicators for competitive moves (OPER-03). Summary stats visible at top. All derived metrics have methodology tooltips.</done>
</task>

</tasks>

<verification>
1. TypeScript compiles with no errors
2. Build succeeds
3. Operations section renders at /:tenant/report/operations
4. Every cell in metrics table has a confidence icon (checkmark, ~, or ?)
5. Diagnostic triggers card lists companies exceeding operational thresholds
6. Cross-link indicators visible for companies also in Competitive Moves
7. Methodology tooltips appear on hover for ROCE and CCC column headers
</verification>

<success_criteria>
- Metrics table has confidence icons per cell (OPER-01)
- Diagnostic triggers card shows A&M service line tags (OPER-02)
- Cross-link badges visible for companies with competitive implications (OPER-03)
- All data from real loaders, no mock data
- Section follows established layout pattern (header, stats, content, footer)
</success_criteria>

<output>
After completion, create `.planning/phases/04-section-group-b/04-02-SUMMARY.md`
</output>
