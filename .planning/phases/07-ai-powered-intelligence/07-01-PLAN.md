---
phase: 07-ai-powered-intelligence
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/types/sections.ts
  - src/data/mock/action-lens.ts
  - src/sections/action-lens/ActionLens.tsx
  - src/sections/action-lens/PersonaSwitcher.tsx
  - src/sections/action-lens/TakeawayCard.tsx
  - src/sections/action-lens/SignalScoreCard.tsx
  - src/sections/action-lens/SignalScoreBar.tsx
  - src/sections/action-lens/PersonaTakeaways.tsx
autonomous: true

must_haves:
  truths:
    - "User sees BD Signal Scores for each signal with numeric score (0-10), trend direction, and context"
    - "Each signal score has a visual bar proportional to its score out of 10"
    - "User can switch between 4 persona views via Radix Tabs: PE/Investors, Founders, COOs/CFOs, Procurement Heads"
    - "Each persona tab shows persona-specific takeaways with actionable steps and urgency badges"
    - "Each takeaway shows related signals as clickable reference chips"
    - "AI confidence/urgency uses ConfidenceBadge component"
    - "Mock data includes all 4 persona datasets"
  artifacts:
    - path: "src/sections/action-lens/ActionLens.tsx"
      provides: "Main Action Lens section with PersonaSwitcher and signal scores"
      min_lines: 40
    - path: "src/sections/action-lens/PersonaSwitcher.tsx"
      provides: "Radix Tabs for persona selection"
      min_lines: 25
    - path: "src/sections/action-lens/TakeawayCard.tsx"
      provides: "Individual takeaway card with urgency badge and related signals"
      min_lines: 25
    - path: "src/sections/action-lens/SignalScoreCard.tsx"
      provides: "Signal score display with score bar and context"
      min_lines: 20
    - path: "src/sections/action-lens/SignalScoreBar.tsx"
      provides: "Visual score bar component"
      min_lines: 10
    - path: "src/sections/action-lens/PersonaTakeaways.tsx"
      provides: "Takeaway list for active persona"
      min_lines: 15
  key_links:
    - from: "src/sections/action-lens/ActionLens.tsx"
      to: "src/hooks/use-filtered-data.ts"
      via: "useFilteredData('action-lens')"
      pattern: "useFilteredData.*action-lens"
    - from: "src/sections/action-lens/TakeawayCard.tsx"
      to: "src/components/ui/ConfidenceBadge.tsx"
      via: "ConfidenceBadge for urgency level"
      pattern: "ConfidenceBadge"
---

<objective>
Build the Action Lens section with BD Signal Scoring, Engagement Opportunity Classification, and persona-based views. This section transforms raw data into consulting-grade BD intelligence.

Purpose: Users need persona-tailored interpretation of market signals. A PE investor cares about different things than a CFO. Signal scoring ranks which signals matter most for BD outreach.

Output: Fully rendered Action Lens section replacing the Phase 2 placeholder, with persona switching (4 personas), signal score rankings, and persona-specific takeaways with actionable steps.
</objective>

<execution_context>
@/Users/prateekkurkanji/.claude/get-shit-done/workflows/execute-plan.md
@/Users/prateekkurkanji/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

@src/types/sections.ts
@src/data/mock/action-lens.ts
@src/hooks/use-filtered-data.ts
@src/components/ui/ConfidenceBadge.tsx
@src/components/ui/InsightCard.tsx
@src/components/ui/TrendIndicator.tsx
@src/components/ui/StatCard.tsx
@src/lib/formatters.ts
@src/theme/tokens.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Extend mock data with all 4 persona datasets and build Action Lens section</name>
  <files>src/types/sections.ts, src/data/mock/action-lens.ts, src/sections/action-lens/ActionLens.tsx, src/sections/action-lens/PersonaSwitcher.tsx, src/sections/action-lens/TakeawayCard.tsx, src/sections/action-lens/SignalScoreCard.tsx, src/sections/action-lens/SignalScoreBar.tsx, src/sections/action-lens/PersonaTakeaways.tsx</files>
  <action>
**1. Extend types** in `src/types/sections.ts`:

The ActionLensData interface currently stores data for a single persona. Extend it to support all 4 personas:

```typescript
export interface ActionLensData extends SectionDataBase {
  section: "action-lens";
  personas: Array<{
    persona: "PE/Investors" | "Founders" | "COOs/CFOs" | "Procurement Heads";
    takeaways: Array<{
      insight: string;
      actionableStep: string;
      urgency: ConfidenceLevel;
      relatedSignals: string[];
    }>;
  }>;
  signalScores: Array<{
    signal: string;
    score: number;
    trend: TrendDirection;
    context: string;
    serviceLine: "Turnaround" | "Growth Strategy" | "Cost Optimization" | "M&A Advisory";
  }>;
}
```

Key changes:
- Change `persona` + `takeaways` to a `personas` array containing all 4 persona datasets
- Add `serviceLine` field to each signal score (for AINL-02 Engagement Opportunity Classification)
- Keep `signalScores` at the top level (signal scores are persona-independent)

**2. Extend mock data** in `src/data/mock/action-lens.ts`:

Restructure to match the new type. Keep the existing PE/Investors takeaways and signal scores. Add 3 more persona datasets:

- **PE/Investors**: Keep existing 4 takeaways
- **Founders**: 3-4 takeaways focused on competitive strategy, market positioning, fundraise timing, operational efficiency
- **COOs/CFOs**: 3-4 takeaways focused on supply chain optimization, working capital management, cost structure improvement, PLI compliance
- **Procurement Heads**: 3-4 takeaways focused on input cost hedging, supplier diversification, backward integration opportunities, inventory optimization

Add `serviceLine` to each signal score:
- "PLI Scheme Execution Momentum" → "Growth Strategy"
- "Kitchen Appliances M&A Velocity" → "M&A Advisory"
- "Mid-Tier Governance Risk" → "Turnaround"
- "Channel Disruption (Quick Commerce)" → "Growth Strategy"

Takeaway content should be plausible and specific to Indian Consumer Durables. Each persona's takeaways should interpret the SAME underlying signals differently based on that persona's priorities.

**3. Build Action Lens components:**

**ActionLens.tsx** (main orchestrator):
- Keep `useFilteredData<ActionLensData>("action-lens")`, loading/error/null handling, header with `DataRecencyTag`.
- Remove placeholder content and `getActiveFilterSummary` helper.
- Layout:
  ```
  <div className="p-md space-y-md">
    {/* Header with title + DataRecencyTag */}
    {/* Signal Scores section */}
    <div>
      <h3 className="text-xs font-medium text-text-secondary uppercase tracking-wide mb-sm">BD Signal Scores</h3>
      <div className="grid grid-cols-2 gap-sm">
        {data.signalScores.sort((a,b) => b.score - a.score).map(signal => (
          <SignalScoreCard key={signal.signal} signal={signal} maxScore={10} />
        ))}
      </div>
    </div>
    {/* Persona Switcher + Takeaways */}
    <PersonaSwitcher personas={data.personas} />
  </div>
  ```

**SignalScoreCard.tsx**:
- Props: `{ signal: { signal: string; score: number; trend: TrendDirection; context: string; serviceLine: string }; maxScore: number }`
- Card layout: `bg-surface-raised border border-surface-overlay rounded p-sm`
  - Signal name in `text-xs font-medium text-text-primary` + TrendIndicator inline
  - Service line badge: config-record mapping serviceLine to colors (Turnaround=negative, Growth Strategy=positive, Cost Optimization=brand-accent, M&A Advisory=chart-2)
  - SignalScoreBar showing score out of maxScore
  - Context in `text-xs text-text-secondary`

**SignalScoreBar.tsx**:
- Props: `{ score: number; maxScore: number }`
- Simple visual bar: container `h-1.5 bg-surface-overlay rounded-full overflow-hidden w-full`
- Filled portion: `h-full rounded-full` with `style={{ width: '${(score/maxScore) * 100}%' }}`
- Color based on score: >=8 → `bg-positive`, >=6 → `bg-brand-accent`, <6 → `bg-neutral`
- Score number displayed to the right: `text-xs font-semibold`

**PersonaSwitcher.tsx**:
- Props: `{ personas: ActionLensData['personas'] }`
- Radix Tabs with `defaultValue="PE/Investors"`:
  - Tab triggers for each persona: `<Tabs.Trigger value={p.persona}>` with persona name
  - Each Tab.Content renders `<PersonaTakeaways takeaways={persona.takeaways} />`
- Tab styling matching Phase 4 DealsTransactions pattern: `text-xs px-sm py-xs font-medium` with `data-[state=active]:text-brand-primary data-[state=active]:border-b-2 data-[state=active]:border-brand-primary`

**PersonaTakeaways.tsx**:
- Props: `{ takeaways: ActionLensData['personas'][0]['takeaways'] }`
- Render a `space-y-sm` list of TakeawayCard components

**TakeawayCard.tsx**:
- Props: `{ takeaway: { insight: string; actionableStep: string; urgency: ConfidenceLevel; relatedSignals: string[] } }`
- Card layout: `bg-surface-raised border border-surface-overlay rounded p-sm`
  - Urgency: ConfidenceBadge with `level={takeaway.urgency}`
  - Insight text in `text-xs text-text-primary` (the main finding)
  - Actionable step: styled with left border `border-l-2 border-l-positive pl-sm` in `text-xs text-text-secondary italic`
  - Related signals: rendered as compact chips/pills in `flex flex-wrap gap-1`, each as `text-xs bg-surface-overlay px-1.5 py-0.5 rounded text-text-muted`

**Important constraints:**
- Import Radix: `import { Tabs } from "radix-ui"`
- ConfidenceBadge reused for urgency display (high/medium/low mapping already works)
- Signal scores are persona-independent (shown above the persona tabs)
- Action Lens uses display names in signals (not company IDs) - these are AI-generated insights
  </action>
  <verify>
Run `npx tsc --noEmit` -- zero TypeScript errors. Verify:
1. Signal scores display with visual bars, trend arrows, and service line badges.
2. Persona tabs switch between 4 views (PE/Investors, Founders, COOs/CFOs, Procurement Heads).
3. Each persona shows relevant takeaways with urgency badges and actionable steps.
4. Related signals appear as reference chips on each takeaway.
  </verify>
  <done>Action Lens section displays BD Signal Scores with engagement classification and 4 persona views with tailored takeaways. Requirements AINL-01, AINL-02, AINL-03, ACTN-01, ACTN-02, ACTN-03 satisfied.</done>
</task>

</tasks>

<verification>
- `npx tsc --noEmit` passes with zero errors
- BD Signal Scores display with composite scores and service line tags (AINL-01, AINL-02)
- AI confidence via ConfidenceBadge on urgency ratings (AINL-03)
- Persona switching between 4 views via Radix Tabs (ACTN-01)
- Each persona shows tailored interpretation of the same signals (ACTN-02)
- Actionable, persona-specific takeaways displayed (ACTN-03)
</verification>

<success_criteria>
Action Lens section renders BD Signal Scores with engagement opportunity classification, and 4 persona views with tailored takeaways and actionable steps. Requirements AINL-01 through AINL-03 and ACTN-01 through ACTN-03 are complete.
</success_criteria>

<output>
After completion, create `.planning/phases/07-ai-powered-intelligence/07-01-SUMMARY.md`
</output>
