---
phase: 03-core-financial-intelligence
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/types/sections.ts
  - src/data/mock/executive.ts
  - src/sections/executive/ExecutiveSnapshot.tsx
  - src/sections/executive/BulletSummary.tsx
  - src/sections/executive/RedFlagsTable.tsx
  - src/sections/executive/ThemeNarrative.tsx
autonomous: true

must_haves:
  truths:
    - "User sees 5 monthly summary bullets each showing theme name, significance badge (high/medium/low), and bullet text"
    - "User sees red flags table with company name, signal text, AI confidence badge (colored), and expandable explanation"
    - "User sees data recency indicator showing 'Data as of Q3 FY25'"
    - "User sees AI narrative per theme explaining BD relevance when expanding a bullet"
    - "Layout is Bloomberg-dense: compact bullet cards in a grid, red flags as a tight table"
  artifacts:
    - path: "src/sections/executive/ExecutiveSnapshot.tsx"
      provides: "Main executive section replacing placeholder"
      min_lines: 40
    - path: "src/sections/executive/BulletSummary.tsx"
      provides: "5-bullet monthly summary grid with significance badges"
      min_lines: 30
    - path: "src/sections/executive/RedFlagsTable.tsx"
      provides: "Red flags table with confidence badges and expandable explanations"
      min_lines: 40
    - path: "src/sections/executive/ThemeNarrative.tsx"
      provides: "AI narrative block per theme for BD relevance"
      min_lines: 15
    - path: "src/data/mock/executive.ts"
      provides: "Enriched mock data with narrative field per bullet"
      contains: "narrative"
    - path: "src/types/sections.ts"
      provides: "Updated ExecutiveSnapshotData with narrative field"
      contains: "narrative"
  key_links:
    - from: "src/sections/executive/ExecutiveSnapshot.tsx"
      to: "useFilteredData"
      via: "hook call"
      pattern: "useFilteredData.*executive"
    - from: "src/sections/executive/ExecutiveSnapshot.tsx"
      to: "DataRecencyTag"
      via: "component import"
      pattern: "DataRecencyTag"
    - from: "src/sections/executive/BulletSummary.tsx"
      to: "ThemeNarrative"
      via: "expandable bullet rendering"
      pattern: "ThemeNarrative"
    - from: "src/sections/executive/RedFlagsTable.tsx"
      to: "Collapsible"
      via: "Radix Collapsible for expandable explanations"
      pattern: "Collapsible"
---

<objective>
Build the Executive Snapshot module -- the landing page users see first when entering a report. Replace the Phase 2 placeholder with a Bloomberg-dense briefing showing 5 monthly summary bullets with significance badges and AI narratives, plus a red flags table with AI confidence scores and expandable explanations.

Purpose: This is the first impression of the entire product. Users scan the executive briefing before drilling into any detail section. High information density and clear visual hierarchy are critical.
Output: Fully functional Executive Snapshot section with bullet summary grid, red flags table, and AI narratives.
</objective>

<execution_context>
@/Users/prateekkurkanji/.claude/get-shit-done/workflows/execute-plan.md
@/Users/prateekkurkanji/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-core-financial-intelligence/03-CONTEXT.md
@.planning/phases/03-core-financial-intelligence/03-RESEARCH.md
@src/types/sections.ts
@src/types/common.ts
@src/data/mock/executive.ts
@src/sections/executive/ExecutiveSnapshot.tsx
@src/hooks/use-filtered-data.ts
@src/components/ui/DataRecencyTag.tsx
@src/components/ui/PerformanceTag.tsx
@src/components/ui/SectionSkeleton.tsx
@src/lib/formatters.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Extend types and mock data for executive narratives</name>
  <files>src/types/sections.ts, src/data/mock/executive.ts</files>
  <action>
1. In `src/types/sections.ts`, add a `narrative` field to the `ExecutiveSnapshotData.bullets` array item type:
   ```
   bullets: Array<{
     text: string;
     theme: string;
     significance: ConfidenceLevel;
     narrative: string;  // AI-generated BD relevance explanation
   }>;
   ```
   This is the ONLY change to sections.ts -- do not touch any other interface.

2. In `src/data/mock/executive.ts`, add a `narrative` field to each of the 5 existing bullet entries. The narrative should be a 2-3 sentence AI explanation of why the theme matters for business development opportunities. Examples:

   - Demand Surge narrative: "Strong AC demand creates capacity constraints -- companies scrambling to expand manufacturing represent immediate consulting opportunities for operational scale-up and distribution optimization. Tier 2-3 expansion requires go-to-market advisory."
   - Input Cost Pressure narrative: "Margin compression from raw materials creates urgency for cost optimization engagements. Companies without forward contracts (most mid-tier players) need procurement strategy and hedging advisory."
   - Policy Tailwind narrative: "PLI scheme beneficiaries need M&A advisory for capacity acquisition and supply chain restructuring to meet production-linked incentive milestones."
   - Channel Shift narrative: "D2C and quick commerce transition creates demand for digital transformation advisory, direct channel economics modeling, and last-mile logistics optimization."
   - Working Capital Stress narrative: "Working capital deterioration signals potential restructuring or turnaround mandates. Companies with 60+ day cycles may seek treasury optimization or trade finance advisory."

   Write the actual narrative text for all 5 bullets -- they should be BD-relevant, specific to Indian Consumer Durables, and 2-3 sentences each.
  </action>
  <verify>Run `npx tsc --noEmit` -- zero errors. The new narrative field is typed correctly and all 5 mock bullet entries have the field populated.</verify>
  <done>ExecutiveSnapshotData type has `narrative: string` on bullets. All 5 mock bullets have compelling BD-relevant narrative text.</done>
</task>

<task type="auto">
  <name>Task 2: Build Executive Snapshot section components</name>
  <files>src/sections/executive/ExecutiveSnapshot.tsx, src/sections/executive/BulletSummary.tsx, src/sections/executive/RedFlagsTable.tsx, src/sections/executive/ThemeNarrative.tsx</files>
  <action>
Create 3 new component files and replace the ExecutiveSnapshot placeholder. All components use existing design tokens from `src/theme/tokens.css` and Phase 1 UI primitives. Bloomberg-dense layout: maximize information per pixel.

**src/sections/executive/ThemeNarrative.tsx:**
- Simple component: receives `narrative: string` prop
- Renders as a compact block with muted background (bg-surface-raised/30), 11px text, italic style
- Prefix with "BD Relevance:" label in bold xs text
- Keep it minimal -- just text rendering with styling

**src/sections/executive/BulletSummary.tsx:**
- Receives `bullets` array (with text, theme, significance, narrative)
- Renders a 2-column CSS grid (1 col on small viewports) of compact cards
- Each card shows:
  - Top row: theme name (bold, xs) + significance badge on the right
  - Significance badge uses colored styling: high = `bg-negative/10 text-negative border-negative/20`, medium = `bg-brand-accent/10 text-brand-accent border-brand-accent/20`, low = `bg-neutral/10 text-neutral border-neutral/20` -- same pattern as PerformanceTag
  - Badge text is significance level uppercased (HIGH, MEDIUM, LOW) in 10px font
  - Body: bullet text in xs text-text-secondary
  - Below bullet text: ThemeNarrative component showing the AI narrative
  - Use Radix Collapsible to make the narrative expandable (collapsed by default)
  - Collapsible trigger is a small "BD Insight" text link with chevron arrow
  - Use `Collapsible` from `"radix-ui"` (NOT from individual packages)
- Card styling: `bg-surface-raised border border-surface-overlay rounded p-md space-y-xs`
- For the 5th bullet (odd count), let it span the remaining grid space naturally (do NOT force full-width)

**src/sections/executive/RedFlagsTable.tsx:**
- Receives `redFlags` array (with company, signal, confidence, explanation)
- Use CSS Grid for the table layout (NOT HTML `<table>`) to avoid Collapsible DOM nesting issues per RESEARCH.md
- Grid columns: `grid-template-columns: minmax(100px, 1fr) 2fr auto auto` for Company, Signal, Confidence, Expand
- Header row: xs text-text-muted font-medium uppercase tracking-wide
- Data rows: xs text, border-b border-surface-overlay, hover:bg-surface-raised/50
- Company name: text-text-primary font-medium
- Signal text: text-text-secondary, truncate with line-clamp-2
- Confidence badge: colored badge following exact same pattern as significance badges in BulletSummary (high=negative colors, medium=brand-accent colors, low=neutral colors)
- Expand column: chevron button that toggles explanation row
- Expandable explanation: use Radix Collapsible in controlled mode. When expanded, show explanation text in a full-width row (spans all 4 columns) with bg-surface-raised/30 padding, xs italic text
- Accessibility: expand button has aria-label "Expand explanation for {company}"

**src/sections/executive/ExecutiveSnapshot.tsx (REPLACE placeholder):**
- Keep the `export default function` pattern (React.lazy requires default export)
- Use `useFilteredData<ExecutiveSnapshotData>("executive")` exactly like the current placeholder
- Loading: `<SectionSkeleton variant="mixed" />`
- Error: `throw error` (caught by SectionWrapper error boundary)
- Layout structure (top to bottom):
  1. Header row: "Executive Snapshot" heading (text-sm font-semibold font-display) + DataRecencyTag on right (same as current)
  2. BulletSummary component with `data.bullets` (note: bullets are theme-level, always shown in full per RESEARCH.md pitfall 6 -- do NOT filter bullets by company)
  3. "Red Flags" subheading (text-xs font-semibold text-text-primary uppercase tracking-wide) with red flag count badge
  4. RedFlagsTable component with `data.redFlags` (these DO get filtered by company via useFilteredData)
- Spacing: space-y-md between major sections
- Remove the placeholder text "Full module will be built in Phase 3" and the getActiveFilterSummary helper function
  </action>
  <verify>
1. Run `npx tsc --noEmit` -- zero type errors
2. Run `npm run build` -- build succeeds with no errors
3. Run `npx vitest run` -- all existing tests pass (no regressions)
  </verify>
  <done>
- Executive Snapshot renders 5 bullet cards in a 2-column grid with theme names, significance badges (colored HIGH/MEDIUM/LOW), bullet text, and expandable AI narratives
- Red flags table shows company name, signal, confidence badge, and expandable explanation for all red flag entries
- DataRecencyTag displays "Data as of Q3 FY25" in the header
- All Phase 1 UI primitives used correctly (no new infrastructure created)
- Section responds to global filters (red flags filtered by company; bullets always shown)
- Requirements covered: EXEC-01 (5-bullet summary), EXEC-02 (red flags with confidence), EXEC-03 (data recency), EXEC-04 (AI narrative)
  </done>
</task>

</tasks>

<verification>
After both tasks complete:
1. `npx tsc --noEmit` passes with zero errors
2. `npm run build` succeeds
3. `npx vitest run` -- all existing tests pass
4. Executive Snapshot section renders bullet cards and red flags table (visual structure matches Bloomberg-dense layout spec)
5. Expandable narratives and explanations open/close correctly
6. Red flags filter when company filter is active in FilterBar
7. Bullets are always shown in full regardless of company filter
</verification>

<success_criteria>
- EXEC-01: 5 monthly summary bullets visible with theme and significance
- EXEC-02: Red flags display with colored AI confidence badges (high/medium/low)
- EXEC-03: DataRecencyTag shows data freshness in section header
- EXEC-04: Each bullet has expandable AI narrative explaining BD relevance
- Bloomberg-dense: compact cards, tight table, maximum information density
- No new dependencies added -- all from existing radix-ui, clsx, existing hooks/primitives
</success_criteria>

<output>
After completion, create `.planning/phases/03-core-financial-intelligence/03-01-SUMMARY.md`
</output>
