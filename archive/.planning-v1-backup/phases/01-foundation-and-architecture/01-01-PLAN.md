---
phase: 01-foundation-and-architecture
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - vite.config.ts
  - tsconfig.json
  - tsconfig.app.json
  - index.html
  - src/main.tsx
  - src/theme/tokens.css
  - src/theme/dark-mode.ts
  - src/brands/types.ts
  - src/brands/kompete.ts
  - src/brands/bcg.ts
  - src/brands/am.ts
  - src/brands/index.ts
  - src/components/brand/BrandProvider.tsx
  - src/components/brand/useBrand.ts
  - src/app/App.tsx
  - src/app/routes.tsx
  - src/components/layout/AppShell.tsx
  - src/components/layout/TopBar.tsx
  - src/components/layout/Sidebar.tsx
  - src/components/layout/SectionWrapper.tsx
  - src/components/errors/SectionErrorFallback.tsx
  - public/brands/kompete/logo.svg
  - public/brands/kompete/favicon.ico
  - public/brands/bcg/logo.svg
  - public/brands/am/logo.svg
autonomous: true

must_haves:
  truths:
    - "Navigating to /kompete/report shows Kompete branding (logo, accent color, font)"
    - "Navigating to /bcg/report shows BCG branding (different logo, BCG green accent, Georgia font)"
    - "Switching from /kompete/report to /bcg/report changes all branding without page reload"
    - "Sidebar lists all 10 report sections with active state highlighting"
    - "Clicking a section in sidebar renders that section's placeholder content with fade-in transition"
    - "All 10 section routes exist and render placeholder content wrapped in SectionWrapper with fade transition"
    - "Dark mode toggle switches light/dark themes; preference persists across page refresh"
    - "An error thrown in one section shows an inline error card with retry button, other sections remain functional"
    - "Unknown tenant slug (e.g., /unknown/report) falls back to Kompete branding"
    - "TopBar displays edition badge with current edition text and brand accent styling"
    - "SectionSkeleton can be imported and used in sections for loading states (wiring into actual section content happens in Phase 3+)"
  artifacts:
    - path: "src/components/brand/BrandProvider.tsx"
      provides: "Tenant resolution from URL slug, data-tenant attribute, favicon/title updates"
      exports: ["BrandProvider", "BrandContext"]
    - path: "src/brands/index.ts"
      provides: "Brand registry mapping slug to BrandConfig"
      exports: ["getBrandConfig"]
    - path: "src/theme/tokens.css"
      provides: "Tailwind v4 @theme tokens, dark mode overrides, tenant CSS variable overrides"
      contains: "@theme"
    - path: "src/app/App.tsx"
      provides: "React Router with /:tenantSlug/report routes for 10 sections"
      contains: "BrowserRouter"
    - path: "src/components/layout/AppShell.tsx"
      provides: "Top bar + sidebar + content area layout"
      min_lines: 20
    - path: "src/components/layout/SectionWrapper.tsx"
      provides: "Error boundary + fade transition wrapper for each section"
      contains: "ErrorBoundary"
    - path: "src/components/errors/SectionErrorFallback.tsx"
      provides: "Inline error card with retry button"
      contains: "resetErrorBoundary"
    - path: "src/theme/dark-mode.ts"
      provides: "Three-way theme toggle (light/dark/system) with localStorage persistence"
      exports: ["initTheme", "applyTheme", "getStoredTheme"]
  key_links:
    - from: "src/components/brand/BrandProvider.tsx"
      to: "src/brands/index.ts"
      via: "getBrandConfig(tenantSlug)"
      pattern: "getBrandConfig"
    - from: "src/components/brand/BrandProvider.tsx"
      to: "src/theme/tokens.css"
      via: "data-tenant attribute triggers CSS variable cascade"
      pattern: "data-tenant"
    - from: "src/app/App.tsx"
      to: "src/components/brand/BrandProvider.tsx"
      via: "Route element wraps AppShell in BrandProvider"
      pattern: "BrandProvider"
    - from: "src/components/layout/SectionWrapper.tsx"
      to: "src/components/errors/SectionErrorFallback.tsx"
      via: "ErrorBoundary FallbackComponent prop"
      pattern: "SectionErrorFallback"
    - from: "index.html"
      to: "src/theme/dark-mode.ts"
      via: "Blocking script prevents flash; dark-mode.ts manages runtime toggles"
      pattern: "theme-preference"
    - from: "src/components/layout/TopBar.tsx"
      to: "src/theme/dark-mode.ts"
      via: "onClick calls applyTheme with cycled theme state"
      pattern: "applyTheme"
---

<objective>
Scaffold the Vite + React 19 + TypeScript project, install all dependencies, configure Tailwind CSS v4 with the multi-tenant brand theming system, set up React Router with tenant-aware routing, build the app shell layout (slim top bar + left sidebar), implement BrandProvider with runtime tenant switching via URL slug, add dark mode support from day one, and wrap sections in error boundaries.

Purpose: This is the foundational scaffold that every subsequent phase builds on. Without it, nothing renders, nothing is branded, and nothing is routed.
Output: A running dev server showing a branded app shell with 10 section navigation links, tenant switching via URL, dark mode toggle, and error-isolated sections.
</objective>

<execution_context>
@/Users/prateekkurkanji/.claude/get-shit-done/workflows/execute-plan.md
@/Users/prateekkurkanji/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation-and-architecture/01-RESEARCH.md
@.planning/phases/01-foundation-and-architecture/01-CONTEXT.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Project scaffold, dependencies, Tailwind v4 theme system, and brand configs</name>
  <files>
    package.json
    vite.config.ts
    tsconfig.json
    tsconfig.app.json
    index.html
    src/main.tsx
    src/theme/tokens.css
    src/theme/dark-mode.ts
    src/brands/types.ts
    src/brands/kompete.ts
    src/brands/bcg.ts
    src/brands/am.ts
    src/brands/index.ts
    public/brands/kompete/logo.svg
    public/brands/kompete/favicon.ico
    public/brands/bcg/logo.svg
    public/brands/am/logo.svg
  </files>
  <action>
    1. **Create Vite project:**
       Run `npm create vite@latest . -- --template react-ts` in the project root (already a git repo, so scaffold in-place). If the directory is not empty, use the `--force` flag or create in a temp directory and move files.

    2. **Install dependencies:**
       ```
       npm install react-router react-error-boundary recharts radix-ui clsx
       npm install -D @tailwindcss/vite tailwindcss
       ```

    3. **Configure Vite** (`vite.config.ts`):
       Import `@tailwindcss/vite` and `@vitejs/plugin-react`. Add both plugins. No other config needed.

    4. **Create `src/theme/tokens.css`** — This is the CRITICAL file. Follow the RESEARCH.md Pattern 1 exactly:
       - `@import "tailwindcss";` at the top
       - `@theme` block defining ALL design tokens as CSS custom properties:
         - Brand colors: `--color-brand-primary` (oklch blue), `--color-brand-secondary`, `--color-brand-accent`
         - Surface colors: `--color-surface`, `--color-surface-raised`, `--color-surface-overlay`
         - Text colors: `--color-text-primary`, `--color-text-secondary`, `--color-text-muted`
         - Chart palette (5 fixed professional colors): `--color-chart-1` through `--color-chart-5` (blue-teal-gray scheme per user decision: "fixed professional palette across tenants")
         - Semantic: `--color-positive` (green), `--color-negative` (red), `--color-neutral` (gray)
         - Typography: `--font-body` (Inter), `--font-display` (Inter default), `--font-mono` (JetBrains Mono)
         - HIGH DENSITY text scale: `--text-xs: 0.6875rem` (11px), `--text-sm: 0.75rem` (12px), `--text-base: 0.8125rem` (13px), `--text-lg: 0.9375rem` (15px), `--text-xl: 1.125rem` (18px)
         - COMPACT spacing: `--spacing-xs: 0.125rem` (2px), `--spacing-sm: 0.25rem` (4px), `--spacing-md: 0.5rem` (8px), `--spacing-lg: 0.75rem` (12px), `--spacing-xl: 1rem` (16px)
         - Fade animation: `--animate-fade-in: fade-in 200ms ease-out`
       - `@custom-variant dark (&:where(.dark, .dark *));`
       - `@layer base` with:
         - `.dark` class overriding surface and text colors for dark mode
         - `[data-tenant="bcg"]` overriding `--color-brand-accent` (BCG green) and `--font-display` (Georgia)
         - `[data-tenant="am"]` overriding `--color-brand-accent` (A&M red-orange) and `--font-display` (Helvetica Neue)
         - `[data-tenant="kompete"]` overriding `--color-brand-accent` (Kompete blue-purple)
       - `@keyframes fade-in` for section transitions
       - NOTE: The `@theme` block must be TOP LEVEL — never nest it inside selectors (see RESEARCH.md Pitfall 1)

    5. **Create `src/theme/dark-mode.ts`** — Three-way toggle (light/dark/system):
       - `getStoredTheme()`: reads localStorage `"theme-preference"`, returns `"light" | "dark" | "system"`, defaults to `"system"`
       - `applyTheme(preference)`: toggles `.dark` class on `document.documentElement`, saves to localStorage
       - `initTheme()`: calls `applyTheme(getStoredTheme())` + listens for `prefers-color-scheme` media query changes when in system mode

    6. **Update `index.html`** — Add blocking dark mode script in `<head>` BEFORE React loads (prevents white flash — see RESEARCH.md Pitfall 4):
       ```html
       <script>
         (function() {
           var pref = localStorage.getItem('theme-preference');
           var isDark = pref === 'dark' ||
             (pref !== 'light' && window.matchMedia('(prefers-color-scheme: dark)').matches);
           if (isDark) document.documentElement.classList.add('dark');
         })();
       </script>
       ```
       Also set `<link rel="icon" href="/brands/kompete/favicon.ico" />` as default.

    7. **Create brand config files:**
       - `src/brands/types.ts`: `BrandConfig` interface with fields: `slug`, `displayName`, `logoUrl`, `faviconUrl`, `accentColor` (oklch string), `fontDisplay`, `fontBody`
       - `src/brands/kompete.ts`: Kompete Intelligence config (default/demo brand, blue-purple accent, Inter font)
       - `src/brands/bcg.ts`: BCG config (green accent, Georgia font)
       - `src/brands/am.ts`: Alvarez & Marsal config (red-orange accent, Helvetica Neue font)
       - `src/brands/index.ts`: Brand registry `Record<string, BrandConfig>` + `getBrandConfig(slug)` function that falls back to Kompete for unknown slugs

    8. **Create placeholder brand assets:**
       - `public/brands/kompete/logo.svg`: Simple SVG text logo saying "Kompete Intelligence" in a professional style
       - `public/brands/kompete/favicon.ico`: Generate a simple 16x16 favicon (can be a colored square)
       - `public/brands/bcg/logo.svg`: SVG text "BCG" in green
       - `public/brands/am/logo.svg`: SVG text "A&M" in red-orange
       These are placeholders — real logos would be provided by clients.

    9. **Update `src/main.tsx`** — Import `tokens.css` (not the old Vite CSS). Call `initTheme()` before rendering.

    10. **Remove Vite default files:** Delete `src/App.css`, `src/index.css`, `src/App.tsx` (we create our own in `src/app/`), and the Vite SVG logo.
  </action>
  <verify>
    Run `npm run dev` and confirm the dev server starts without errors. Open browser devtools console — no errors.
    Run `npx tsc --noEmit` to verify TypeScript compiles cleanly.
    Inspect the generated CSS output to confirm `--color-brand-primary` and other custom properties exist.
  </verify>
  <done>
    Vite dev server runs. TypeScript compiles with zero errors. tokens.css generates all design token CSS custom properties. Three brand configs exist with fallback to Kompete. Dark mode blocking script is in index.html head. `initTheme()` is called in main.tsx.
  </done>
</task>

<task type="auto">
  <name>Task 2: BrandProvider, React Router shell, app layout, and error boundaries</name>
  <files>
    src/components/brand/BrandProvider.tsx
    src/components/brand/useBrand.ts
    src/app/App.tsx
    src/app/routes.tsx
    src/components/layout/AppShell.tsx
    src/components/layout/TopBar.tsx
    src/components/layout/Sidebar.tsx
    src/components/layout/SectionWrapper.tsx
    src/components/errors/SectionErrorFallback.tsx
  </files>
  <action>
    1. **Create `src/components/brand/BrandProvider.tsx`** — Follow RESEARCH.md Pattern 1:
       - Uses `useParams<{ tenantSlug: string }>()` from react-router to read the slug
       - Calls `getBrandConfig(tenantSlug ?? "kompete")` to resolve brand
       - `useEffect` sets `data-tenant` attribute on `document.documentElement` (for CSS cascade), updates favicon link href, updates document title to `"{brand.displayName} | Industry Landscape"`
       - Renders a `<div data-tenant={brand.slug}>` wrapper around children (so CSS variables cascade)
       - Provides `BrandContext` with the `BrandConfig` value using React 19's `<Context value={...}>` pattern (not the old `<Context.Provider>`)
       - IMPORTANT: Also set `data-tenant` on `document.documentElement` so that dark mode overrides in `.dark[data-tenant="bcg"]` work if needed

    2. **Create `src/components/brand/useBrand.ts`** — Custom hook:
       - Uses React 19's `use(BrandContext)` (not `useContext`)
       - Throws helpful error if used outside BrandProvider

    3. **Create `src/app/routes.tsx`** — Define the 10 section routes as a constant array:
       ```
       executive, market-pulse, financial, deals, operations,
       leadership, competitive, deep-dive, action-lens, watchlist
       ```
       Each with a `path` and `label` (human-readable name). Export this array for use by both App.tsx and Sidebar.

    4. **Create `src/app/App.tsx`** — React Router setup (declarative mode, NOT framework mode):
       - `<BrowserRouter>` wrapping all routes
       - Route `/:tenantSlug/report` wraps `<BrandProvider><AppShell /></BrandProvider>`
       - Nested child route `index` redirects to `executive` (first section)
       - Each of the 10 section paths renders a placeholder `<div>` for now (wrapped in SectionWrapper)
       - Route `/` redirects to `/kompete/report`
       - Catch-all `*` redirects to `/kompete/report`
       - Import from `react-router` (NOT `react-router-dom` — merged in v7, see RESEARCH.md)

    5. **Create `src/components/layout/AppShell.tsx`** — The main layout:
       - Structure: flex row with Sidebar on left (fixed width ~200px, collapsible on mobile) + main content area that fills remaining space
       - TopBar is positioned at the top spanning the full width
       - Content area renders `<Outlet />` from react-router for the active section
       - Use Tailwind classes with the custom spacing tokens: `p-md`, `gap-sm`, etc.
       - Style matches "Bloomberg terminal meets consulting": dark surface backgrounds, clean borders, high density

    6. **Create `src/components/layout/TopBar.tsx`** — Slim header bar:
       - Left: Tenant logo (from `useBrand().logoUrl`) as an `<img>` tag
       - Center/Right: Edition badge — render `<EditionBadge edition="February 2026" />` placeholder text styled with `bg-brand-accent/10 text-brand-accent text-xs font-medium px-sm py-xs rounded` (inline for now since EditionBadge component is created in Plan 02; use a simple `<span>` with these classes until then)
       - Right: Dark mode toggle button. Use `useState` initialized from `getStoredTheme()` (imported from `src/theme/dark-mode.ts`) to track the current preference. Wire the button's `onClick` to cycle through `['light', 'dark', 'system']` states in order (light -> dark -> system -> light -> ...). On each click, update the state and call `applyTheme(newPreference)` from `src/theme/dark-mode.ts`. Display a sun icon for light, moon icon for dark, and monitor/auto icon for system mode (use simple Unicode or inline SVG icons). Show the current mode label (e.g., "Light", "Dark", "System") next to the icon for clarity.
       - Height: compact (~40-48px per high-density constraint)
       - Background: `bg-surface-raised`, subtle bottom border

    7. **Create `src/components/layout/Sidebar.tsx`** — Left navigation:
       - Renders all 10 section links using the routes array from routes.tsx
       - Uses `NavLink` from react-router for automatic active state styling
       - Active link gets `bg-brand-accent/10 text-brand-accent border-l-2 border-brand-accent` styling
       - Inactive links: `text-text-secondary hover:text-text-primary hover:bg-surface-raised`
       - Width: ~200px, fixed. Background: `bg-surface`
       - Section names in `text-xs` for high density
       - Subtle section group dividers if desired

    8. **Create `src/components/errors/SectionErrorFallback.tsx`** — Inline error card (Claude's discretion: inline card, not toast):
       - Centered within the section area
       - Shows "Unable to load this section" message
       - Shows `error.message` in monospace font
       - "Retry" button calling `resetErrorBoundary`
       - Styled with `bg-surface-raised`, `border-negative/20` border, brand-primary button
       - Does NOT crash other sections — this is isolated per ErrorBoundary

    9. **Create `src/components/layout/SectionWrapper.tsx`** — Wraps each section route:
       - `<ErrorBoundary FallbackComponent={SectionErrorFallback} resetKeys={[sectionKey]}>` from react-error-boundary
       - Inside the boundary: `<div className="animate-fade-in h-full overflow-auto">` for the fade-in transition per user decision
       - Accepts `sectionKey` prop (the route path) so error boundary resets when navigating away and back

    10. **Wire everything together in App.tsx:**
        - Each section route element should be: `<SectionWrapper sectionKey="executive"><PlaceholderContent label="Executive Snapshot" /></SectionWrapper>`
        - Create a simple `PlaceholderContent` component inline or as a separate tiny component that renders the section name — this will be replaced by real modules in later phases
        - IMPORTANT: Every one of the 10 section routes MUST render a visible placeholder (not an empty div). Each placeholder should display the section label text (e.g., "Executive Snapshot", "Market Pulse") so navigating to any route shows meaningful content wrapped in SectionWrapper with fade transition.
  </action>
  <verify>
    Run `npm run dev` and test these scenarios in the browser:
    1. Navigate to `http://localhost:5173/kompete/report` — see Kompete logo and blue-purple accent
    2. Navigate to `http://localhost:5173/bcg/report` — see BCG logo, green accent, Georgia font on headings
    3. Navigate to `http://localhost:5173/am/report` — see A&M branding
    4. Navigate to `http://localhost:5173/` — redirects to `/kompete/report`
    5. Click different sections in sidebar — content area shows placeholder with fade-in
    6. Active section is highlighted in sidebar
    7. Toggle dark mode — cycles light -> dark -> system, all surfaces and text switch themes, preference persists after page refresh
    8. Edition badge visible in TopBar with brand accent styling
    9. Run `npx tsc --noEmit` — zero TypeScript errors
  </verify>
  <done>
    App shell renders with TopBar (tenant logo + edition badge with brand accent styling + dark mode toggle cycling light/dark/system) and Sidebar (10 sections with active state). All 10 section routes render visible placeholder content wrapped in SectionWrapper with fade-in transition. Navigating between /kompete/report, /bcg/report, and /am/report switches all branding (logo, accent colors, typography) without page reload. Dark mode toggle cycles through light/dark/system via useState + applyTheme, and persists. Each section is wrapped in an error boundary. Unknown tenant slugs fall back to Kompete. The app compiles and runs with zero TypeScript errors.
  </done>
</task>

</tasks>

<verification>
1. `npm run dev` starts without errors
2. `npx tsc --noEmit` passes with zero errors
3. Navigate to /kompete/report — Kompete branding visible (logo, colors)
4. Navigate to /bcg/report — BCG branding visible (different logo, green accent, Georgia font)
5. Change URL from /bcg/report to /am/report — branding switches without page reload
6. Sidebar shows 10 sections, clicking each shows placeholder with fade transition
7. All 10 section routes render visible placeholder content (not empty divs) in SectionWrapper
8. Dark mode toggle cycles light/dark/system, preference persists on refresh
9. No dark mode flash on page load (blocking script works)
10. Navigate to /unknown-slug/report — falls back to Kompete branding
11. Navigate to / — redirects to /kompete/report
12. TopBar edition badge displays with brand accent styling
</verification>

<success_criteria>
- Multi-tenant BrandProvider resolves tenant from URL slug and injects brand tokens as CSS custom properties
- Three brand configs (kompete, bcg, am) with distinct accent colors and fonts
- App shell with slim top bar, left sidebar (10 sections), and routed content area
- Dark mode support with three-way toggle (light/dark/system cycling via useState + applyTheme) and localStorage persistence
- Error boundaries isolate section failures
- All 10 routes render placeholder content wrapped in SectionWrapper with fade transition
- TopBar displays edition badge with brand accent styling
- All TypeScript compiles cleanly
- Dev server runs and renders correctly
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-and-architecture/01-01-SUMMARY.md`
</output>