---
phase: 04-deal-flow-and-leadership-signals
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/lib/formatters.ts
  - src/components/ui/ConfidenceBadge.tsx
  - src/components/ui/InsightCard.tsx
  - src/components/ui/DealTypeBadge.tsx
  - src/sections/deals/DealCard.tsx
  - src/sections/deals/DealTimeline.tsx
  - src/sections/deals/DealSummaryStats.tsx
  - src/sections/deals/DealPatterns.tsx
  - src/sections/deals/DealsTransactions.tsx
autonomous: true

must_haves:
  truths:
    - "User sees M&A transactions with acquirer, target, deal value in INR Cr, and rationale"
    - "User sees PE/VC investments with investor, company, amount, and rationale"
    - "User sees IPO filings and distressed asset activity"
    - "User can switch between All / M&A / PE/VC / IPO / Distressed via tabs"
    - "Timeline visualization shows deals ordered chronologically with vertical line and dot markers"
    - "AI pattern recognition cards display deal clusters with confidence badges"
    - "Summary stats show total deal count, total value, and pattern count at a glance"
  artifacts:
    - path: "src/sections/deals/DealsTransactions.tsx"
      provides: "Main deals section replacing Phase 2 placeholder"
      exports: ["default"]
    - path: "src/sections/deals/DealTimeline.tsx"
      provides: "Vertical timeline with chronologically sorted deal cards"
      exports: ["DealTimeline"]
    - path: "src/sections/deals/DealCard.tsx"
      provides: "Individual deal card with type badge, parties, value, rationale, date, source"
      exports: ["DealCard"]
    - path: "src/sections/deals/DealSummaryStats.tsx"
      provides: "4-column stat card grid for deals overview"
      exports: ["DealSummaryStats"]
    - path: "src/sections/deals/DealPatterns.tsx"
      provides: "AI pattern recognition cards section"
      exports: ["DealPatterns"]
    - path: "src/components/ui/ConfidenceBadge.tsx"
      provides: "Reusable AI confidence level pill badge (high/medium/low)"
      exports: ["ConfidenceBadge"]
    - path: "src/components/ui/InsightCard.tsx"
      provides: "Reusable AI insight display card with confidence, variant coloring"
      exports: ["InsightCard"]
    - path: "src/components/ui/DealTypeBadge.tsx"
      provides: "Color-coded deal type badge (M&A, PE/VC, IPO, distressed)"
      exports: ["DealTypeBadge"]
    - path: "src/lib/formatters.ts"
      provides: "formatDate and formatMonthYear functions added"
      contains: "formatDate"
  key_links:
    - from: "src/sections/deals/DealsTransactions.tsx"
      to: "/api (useFilteredData)"
      via: "useFilteredData('deals')"
      pattern: "useFilteredData.*deals"
    - from: "src/sections/deals/DealsTransactions.tsx"
      to: "src/sections/deals/DealTimeline.tsx"
      via: "renders DealTimeline with filtered deals"
      pattern: "<DealTimeline"
    - from: "src/sections/deals/DealTimeline.tsx"
      to: "src/sections/deals/DealCard.tsx"
      via: "maps sorted deals to DealCard components"
      pattern: "<DealCard"
    - from: "src/sections/deals/DealCard.tsx"
      to: "src/components/ui/DealTypeBadge.tsx"
      via: "renders DealTypeBadge for deal type"
      pattern: "<DealTypeBadge"
    - from: "src/sections/deals/DealPatterns.tsx"
      to: "src/components/ui/InsightCard.tsx"
      via: "renders InsightCard for each AI pattern"
      pattern: "<InsightCard"
    - from: "src/sections/deals/DealsTransactions.tsx"
      to: "Radix Tabs"
      via: "Tabs.Root with defaultValue for deal type filtering"
      pattern: "Tabs\\.Root"
---

<objective>
Build the complete Deals & Transactions module replacing the Phase 2 placeholder. Create three new shared UI components (ConfidenceBadge, InsightCard, DealTypeBadge) that will be reused across Phase 4 and future phases. Implement a vertical CSS timeline showing 8 deals chronologically, Radix Tabs for deal type filtering, summary stat cards, and AI pattern recognition cards.

Purpose: Enables consulting partners to track money movements (M&A, PE/VC, IPOs, distressed assets) in Indian Consumer Durables -- the event-based signals that directly trigger BD outreach.
Output: Working Deals & Transactions section with timeline visualization, tab filtering, and AI pattern cards. Three new reusable shared components.
</objective>

<execution_context>
@/Users/prateekkurkanji/.claude/get-shit-done/workflows/execute-plan.md
@/Users/prateekkurkanji/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-deal-flow-and-leadership-signals/04-RESEARCH.md

@src/types/sections.ts (DealsTransactionsData interface -- deal shape, aiPatterns shape)
@src/types/common.ts (ConfidenceLevel, TrendDirection types)
@src/data/mock/deals.ts (8 deals, 3 AI patterns -- the actual data being rendered)
@src/hooks/use-filtered-data.ts (useFilteredData hook -- data fetching + filtering)
@src/lib/formatters.ts (formatINRCr, formatPercent -- add formatDate, formatMonthYear here)
@src/components/ui/StatCard.tsx (reuse for summary stats)
@src/components/ui/DataRecencyTag.tsx (reuse for header)
@src/components/ui/SectionSkeleton.tsx (reuse for loading state)
@src/components/ui/PerformanceTag.tsx (reference pattern for badge component styling)
@src/sections/deals/DealsTransactions.tsx (current placeholder -- replace entirely)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Shared UI components and date formatters</name>
  <files>
    src/lib/formatters.ts
    src/components/ui/ConfidenceBadge.tsx
    src/components/ui/InsightCard.tsx
    src/components/ui/DealTypeBadge.tsx
  </files>
  <action>
**1. Add date formatters to `src/lib/formatters.ts`:**
Append two new formatters after the existing `formatIndianNumber` function. Use module-scope `Intl.DateTimeFormat` instances (same pattern as existing `indianNumberFormatter`):

```typescript
const dateFormatter = new Intl.DateTimeFormat("en-IN", {
  day: "numeric", month: "short", year: "numeric",
});
const monthYearFormatter = new Intl.DateTimeFormat("en-IN", {
  month: "short", year: "numeric",
});

export function formatDate(isoDate: string): string {
  return dateFormatter.format(new Date(isoDate));
}

export function formatMonthYear(isoDate: string): string {
  return monthYearFormatter.format(new Date(isoDate));
}
```

Do NOT modify any existing formatters. Append only.

**2. Create `src/components/ui/ConfidenceBadge.tsx`:**
Color-coded pill badge for AI confidence levels (high/medium/low). Follow the exact same styling pattern as `PerformanceTag.tsx` -- config record mapping level to `{ label, className }`, using `bg-{color}/10 text-{color} border-{color}/20` pattern.

- Import `ConfidenceLevel` from `../../types/common`
- `high`: `bg-positive/10 text-positive border-positive/20` (green = confident)
- `medium`: `bg-brand-accent/10 text-brand-accent border-brand-accent/20` (blue = moderate)
- `low`: `bg-neutral/10 text-neutral border-neutral/20` (gray = uncertain)
- Use same base classes as PerformanceTag: `inline-flex items-center px-sm py-xs rounded border text-[10px] font-medium whitespace-nowrap`
- Named export `ConfidenceBadge`

**3. Create `src/components/ui/InsightCard.tsx`:**
AI insight/pattern display card with colored left border indicating variant type. Props:
- `icon?: string` (emoji/symbol for visual scanning)
- `title: string`
- `confidence: ConfidenceLevel`
- `explanation: string`
- `variant?: "pattern" | "risk" | "opportunity"` (default "pattern")
- `className?: string`

Implementation:
- Import `clsx` and `ConfidenceBadge`
- Left border color by variant: `pattern` = `border-l-chart-1`, `risk` = `border-l-negative`, `opportunity` = `border-l-positive`
- Card uses `bg-surface-raised border border-surface-overlay rounded p-md border-l-2`
- Header row: icon + title on left, ConfidenceBadge on right
- Body: explanation text in `text-xs text-text-secondary leading-relaxed`
- Named export `InsightCard`

**4. Create `src/components/ui/DealTypeBadge.tsx`:**
Color-coded badge for deal type (M&A, PE/VC, IPO, distressed). Same config-record pattern as PerformanceTag/ConfidenceBadge.

- Type `DealType = "M&A" | "PE/VC" | "IPO" | "distressed"` (matches DealsTransactionsData deal.type union)
- Colors: `M&A` = chart-1, `PE/VC` = chart-2, `IPO` = chart-3, `distressed` = negative
- Each uses `bg-{color}/10 text-{color} border-{color}/20` pattern
- Labels: "M&A", "PE/VC", "IPO", "Distressed"
- Same base classes as PerformanceTag/ConfidenceBadge
- Named export `DealTypeBadge`
  </action>
  <verify>
Run `npx tsc --noEmit` from project root -- zero errors. Verify all 4 files exist: `ls src/components/ui/ConfidenceBadge.tsx src/components/ui/InsightCard.tsx src/components/ui/DealTypeBadge.tsx src/lib/formatters.ts`. Run existing tests: `npx vitest run` -- all pass (formatters tests still green).
  </verify>
  <done>
Three new shared UI components (ConfidenceBadge, InsightCard, DealTypeBadge) exist with correct exports and TypeScript types. Two new date formatters (formatDate, formatMonthYear) added to formatters.ts without breaking existing tests. All files compile cleanly.
  </done>
</task>

<task type="auto">
  <name>Task 2: Deals & Transactions section with timeline and tabs</name>
  <files>
    src/sections/deals/DealCard.tsx
    src/sections/deals/DealTimeline.tsx
    src/sections/deals/DealSummaryStats.tsx
    src/sections/deals/DealPatterns.tsx
    src/sections/deals/DealsTransactions.tsx
  </files>
  <action>
**1. Create `src/sections/deals/DealCard.tsx`:**
Individual deal card for the timeline. Imports DealTypeBadge, formatINRCr, formatDate.

Props interface: `{ deal: DealsTransactionsData["deals"][number] }` (reuse the type directly from sections.ts).

Layout (top to bottom):
- Header row: `<DealTypeBadge type={deal.type} />` on left, formatted date (`formatDate(deal.date)`) on right in `text-[10px] text-text-muted`
- Parties line: `text-xs font-medium text-text-primary`. Format based on type:
  - M&A: `"{parties[0]} -> {parties[1]}"` (use right arrow Unicode U+2192)
  - PE/VC with 2+ parties: `"{parties[1]} invests in {parties[0]}"`
  - Otherwise: `parties.join(", ")`
- Value (only if `deal.valueCr !== null`): `formatINRCr(deal.valueCr)` in `text-sm font-semibold text-text-primary`
- Rationale: `text-xs text-text-secondary leading-relaxed line-clamp-2` (truncated to 2 lines)
- Source: `text-[10px] text-text-muted` prefixed with "Source: "

Card wrapper: `bg-surface-raised border border-surface-overlay rounded p-md space-y-xs`
Named export `DealCard`.

**2. Create `src/sections/deals/DealTimeline.tsx`:**
Pure CSS vertical timeline using Tailwind. No external timeline library.

Props: `{ deals: DealsTransactionsData["deals"] }`

Implementation:
- Sort deals chronologically newest-first: `[...deals].sort((a, b) => new Date(b.date).getTime() - new Date(a.date).getTime())`
- If `deals.length === 0`, render an empty state: `<p className="text-xs text-text-muted italic py-md">No deals match current filters.</p>`
- Container: `<div className="relative ml-4">` with an absolute vertical line `<div className="absolute left-0 top-0 bottom-0 w-px bg-surface-overlay" />`
- Each deal: `<div className="relative pl-8">` with:
  - Dot: `<div className="absolute left-0 top-4 -translate-x-1/2 w-2 h-2 rounded-full bg-brand-accent border-2 border-surface" />`
  - `<DealCard deal={deal} />`
- Space between items: `space-y-md` on the list container

Named export `DealTimeline`.

**3. Create `src/sections/deals/DealSummaryStats.tsx`:**
Grid of 4 StatCard components.

Props: `{ deals: DealsTransactionsData["deals"]; patternCount: number }`

Compute:
- `totalDeals = deals.length`
- `totalValue = deals.filter(d => d.valueCr !== null).reduce((sum, d) => sum + (d.valueCr ?? 0), 0)` -- format with `formatINRCr`
- `maCount = deals.filter(d => d.type === "M&A").length`
- Use `patternCount` directly for AI Patterns count

Layout: `<div className="grid grid-cols-4 gap-md">` with 4 StatCard components:
- `label="Total Deals" value={String(totalDeals)}`
- `label="Total Value" value={formatINRCr(totalValue)}`
- `label="M&A Deals" value={String(maCount)}`
- `label="AI Patterns" value={String(patternCount)}`

Named export `DealSummaryStats`.

**4. Create `src/sections/deals/DealPatterns.tsx`:**
Renders AI pattern recognition cards.

Props: `{ patterns: DealsTransactionsData["aiPatterns"] }`

If `patterns.length === 0`, return `null`.

Layout:
- Section header: `<h3 className="text-xs font-semibold text-text-primary">AI Pattern Recognition</h3>`
- Map patterns to InsightCard components: `<InsightCard title={p.pattern} confidence={p.confidence} explanation={p.explanation} variant="pattern" />`
- Wrapper: `<div className="space-y-sm">`

Named export `DealPatterns`.

**5. Replace `src/sections/deals/DealsTransactions.tsx`:**
Complete rewrite replacing the Phase 2 placeholder. This is the main section component.

Imports: useFilteredData, DataRecencyTag, SectionSkeleton, Tabs from "radix-ui", and the 4 sub-components above.

Data flow:
```
const { data, isPending, error } = useFilteredData<DealsTransactionsData>("deals");
```

Loading/error handling same pattern as placeholder: SectionSkeleton variant="mixed" for pending, throw error, return null for no data.

Define deal type tabs:
```typescript
const DEAL_TYPES = [
  { value: "all", label: "All Deals" },
  { value: "M&A", label: "M&A" },
  { value: "PE/VC", label: "PE/VC" },
  { value: "IPO", label: "IPO" },
  { value: "distressed", label: "Distressed" },
] as const;
```

Layout (top to bottom):
1. **Header row**: h2 "Deals & Transactions" + DataRecencyTag (same pattern as placeholder)
2. **DealSummaryStats**: `<DealSummaryStats deals={data.deals} patternCount={data.aiPatterns.length} />`
3. **Tabbed Timeline**: Radix Tabs (uncontrolled, `defaultValue="all"`)
   - `Tabs.List`: flex row with tab triggers styled per RESEARCH.md pattern 2 (`data-[state=active]:text-brand-accent data-[state=active]:border-b-2 data-[state=active]:border-brand-accent`)
   - `Tabs.Content` for "all": `<DealTimeline deals={data.deals} />`
   - `Tabs.Content` for each type: `<DealTimeline deals={data.deals.filter(d => d.type === type)} />`
4. **DealPatterns**: `<DealPatterns patterns={data.aiPatterns} />`

Import Tabs as `import { Tabs } from "radix-ui"` (matches existing codebase pattern from SelectFilter.tsx).

CRITICAL: Use `export default function DealsTransactions()` -- React.lazy requires default export per [02-02] decision.

Do NOT include filter summary display from the placeholder -- that was only for proving the pipeline. The real section focuses on deals content.
  </action>
  <verify>
Run `npx tsc --noEmit` from project root -- zero errors. Run `npx vite build` -- builds successfully with no warnings. Open `http://localhost:5173` (start dev server if needed with `npx vite --port 5173`), navigate to Deals & Transactions section, and verify: (1) 4 stat cards appear at top, (2) vertical timeline shows deal cards with type badges and formatted dates, (3) clicking tab triggers filters timeline to only that deal type, (4) AI pattern cards appear below timeline with confidence badges, (5) deals with null valueCr show no value line (deal-005, deal-006).
  </verify>
  <done>
Deals & Transactions section fully replaces Phase 2 placeholder. Vertical timeline displays 8 deals chronologically. Radix Tabs filter by deal type (All/M&A/PE/VC/IPO/Distressed). Summary stats show deal count, total value, M&A count, and AI pattern count. AI pattern recognition cards display 3 patterns with confidence badges. Empty state message appears when filters reduce deals to zero. Null-value deals display without value line. Requirements DEAL-01 through DEAL-06 addressed.
  </done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes with zero errors
2. `npx vitest run` passes (existing formatter tests still green)
3. `npx vite build` completes without errors
4. Deals & Transactions section renders at `/bcg/report` when navigating to that section
5. All 4 deal types have at least 1 deal visible in timeline
6. Tab switching filters timeline correctly (e.g., M&A tab shows 3 deals, PE/VC shows 3 deals, IPO shows 1, Distressed shows 1)
7. Deal-005 and deal-006 (null valueCr) render without value line or formatting error
8. ConfidenceBadge, InsightCard, DealTypeBadge are importable from src/components/ui/
</verification>

<success_criteria>
- DEAL-01: M&A transactions display with acquirer, target, value, rationale
- DEAL-02: PE/VC investments display with investor, company, amount, rationale
- DEAL-03: IPO filing activity displayed
- DEAL-04: Distressed asset activity displayed
- DEAL-05: Chronological timeline visualization with vertical line and deal cards
- DEAL-06: AI pattern recognition highlights deal clusters with confidence scores
- Three new shared UI components (ConfidenceBadge, InsightCard, DealTypeBadge) available for 04-02 and future phases
- Date formatters (formatDate, formatMonthYear) added to formatters.ts
</success_criteria>

<output>
After completion, create `.planning/phases/04-deal-flow-and-leadership-signals/04-01-SUMMARY.md`
</output>
