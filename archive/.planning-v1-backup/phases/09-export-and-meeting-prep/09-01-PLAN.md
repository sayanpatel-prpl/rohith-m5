---
phase: 09-export-and-meeting-prep
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/export/ExportToolbar.tsx
  - src/components/export/PDFExport.tsx
  - src/components/export/CSVExport.tsx
  - src/components/layout/AppShell.tsx
autonomous: true

must_haves:
  truths:
    - "User sees an Export button in the report header/toolbar area"
    - "Clicking Export shows options: PDF (full report or selected sections) and CSV (data tables)"
    - "PDF export triggers browser print with print-optimized CSS (@media print styles)"
    - "CSV export downloads a CSV file for the currently active section's tabular data"
    - "Print styles hide navigation, filters, and non-essential UI elements"
    - "Print styles preserve brand colors and typography"
  artifacts:
    - path: "src/components/export/ExportToolbar.tsx"
      provides: "Export button with dropdown menu for PDF and CSV options"
      min_lines: 30
    - path: "src/components/export/PDFExport.tsx"
      provides: "PDF export via window.print() with print-optimized styles"
      min_lines: 20
    - path: "src/components/export/CSVExport.tsx"
      provides: "CSV generation and download for tabular section data"
      min_lines: 40
  key_links:
    - from: "src/components/export/ExportToolbar.tsx"
      to: "src/components/layout/AppShell.tsx"
      via: "ExportToolbar rendered in report header"
      pattern: "ExportToolbar"
---

<objective>
Build PDF and CSV export capabilities for the Industry Landscape report.

Purpose: Users need to take intelligence out of the platform into meetings. PDF export provides a print-ready version of the full report or selected sections. CSV export provides raw data for spreadsheet analysis.

Output: ExportToolbar with PDF and CSV export options, print-optimized CSS, and CSV download functionality.
</objective>

<execution_context>
@/Users/prateekkurkanji/.claude/get-shit-done/workflows/execute-plan.md
@/Users/prateekkurkanji/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

@src/components/layout/AppShell.tsx
@src/theme/tokens.css
@src/types/common.ts
@src/types/sections.ts
@src/data/mock/financial.ts
@src/data/mock/competitive.ts
@src/data/mock/watchlist.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Build ExportToolbar with PDF and CSV export</name>
  <files>src/components/export/ExportToolbar.tsx, src/components/export/PDFExport.tsx, src/components/export/CSVExport.tsx, src/components/layout/AppShell.tsx, src/theme/tokens.css</files>
  <action>
**1. Create ExportToolbar** at `src/components/export/ExportToolbar.tsx`:
- A compact toolbar component with a Radix DropdownMenu:
  ```typescript
  import { DropdownMenu } from "radix-ui";
  ```
- Trigger button: `text-xs font-medium px-sm py-xs bg-surface-raised border border-surface-overlay rounded hover:bg-surface-overlay` with text "Export" and a down arrow icon (Unicode ▾).
- Menu items:
  - "Export as PDF" → calls `handlePDFExport()` which invokes `window.print()`
  - "Export Data as CSV" → calls `handleCSVExport()` which generates and downloads CSV
- Props: `{ activeSection: SectionId }` to know which section's data to export as CSV.
- The PDF export is simple: just trigger `window.print()`. The print CSS will handle layout.
- The CSV export:
  - Import the appropriate mock data based on `activeSection`
  - For sections with tabular data (financial, competitive, watchlist), convert to CSV format
  - For sections without tabular data, show a toast/alert "No tabular data available for this section"
  - Use a utility function to convert arrays of objects to CSV strings
  - Download via creating a Blob, Object URL, and programmatic anchor click

**2. Create PDFExport** at `src/components/export/PDFExport.tsx`:
- Export a utility function `triggerPDFExport()` that:
  - Calls `window.print()` to trigger the browser's print dialog
  - The user can choose "Save as PDF" from the print dialog
- This is intentionally simple. No external PDF library needed.

**3. Create CSVExport** at `src/components/export/CSVExport.tsx`:
- Export utility functions:
  ```typescript
  function arrayToCSV(data: Record<string, unknown>[], columns?: string[]): string
  function downloadCSV(csv: string, filename: string): void
  function exportSectionAsCSV(sectionId: SectionId): void
  ```
- `arrayToCSV`: takes array of objects, extracts headers from first object (or uses provided columns), escapes values containing commas/quotes, generates CSV string.
- `downloadCSV`: creates a Blob with type "text/csv", creates an Object URL, creates a temporary anchor element, triggers click, revokes URL.
- `exportSectionAsCSV`: switch on sectionId:
  - "financial" → export companies array with metrics (name, revenueGrowth, ebitdaMargin, workingCapitalDays, roce, debtEquity, performanceTier)
  - "competitive" → export productLaunches + pricingActions as separate sheets (download two CSVs or combine with a header row separator)
  - "watchlist" → export all 4 signal categories combined
  - "deals" → export all deals
  - "leadership" → export CXO changes + board reshuffles
  - For sections without tabular data (executive, market-pulse, deep-dive, action-lens, operations): alert "No tabular data available for CSV export from this section"

**4. Add print styles** to `src/theme/tokens.css`:
Add `@media print` styles at the end of the file:
```css
@media print {
  /* Hide non-essential UI */
  [data-print-hide] {
    display: none !important;
  }

  /* Full width layout */
  body {
    background: white !important;
  }

  /* Preserve brand typography */
  .font-display {
    font-family: var(--font-display) !important;
  }
}
```

**5. Integrate ExportToolbar into AppShell**:
- Read `src/components/layout/AppShell.tsx`
- Add ExportToolbar to the header area next to existing controls
- Pass the current active section as a prop
- Add `data-print-hide` attribute to the sidebar, filter bar, and export toolbar itself (these should not appear in print)

**Important constraints:**
- Keep it simple: `window.print()` for PDF, no external PDF library
- CSV uses vanilla JS (no Papa Parse or similar -- it's a simple export)
- The ExportToolbar should be compact and blend with the Bloomberg-dense header
- Use Radix DropdownMenu for the export options
  </action>
  <verify>
Run `npx tsc --noEmit` -- zero TypeScript errors. Verify:
1. Export button appears in the report header.
2. Clicking Export shows dropdown with PDF and CSV options.
3. PDF export triggers browser print dialog.
4. CSV export downloads a file for sections with tabular data.
5. Print styles hide sidebar, filters, and export button.
  </verify>
  <done>Export toolbar with PDF and CSV export functionality integrated into the report shell. Print CSS hides non-essential UI. Requirements EXPT-01, EXPT-02 satisfied.</done>
</task>

</tasks>

<verification>
- `npx tsc --noEmit` passes with zero errors
- Export button visible in report header
- PDF export via browser print (EXPT-01)
- CSV export for tabular sections (EXPT-02)
- Print CSS hides navigation, filters, toolbar
</verification>

<success_criteria>
ExportToolbar renders in the report header with PDF and CSV export options. PDF uses browser print with print-optimized CSS. CSV generates downloadable files for tabular data sections. Requirements EXPT-01 and EXPT-02 are complete.
</success_criteria>

<output>
After completion, create `.planning/phases/09-export-and-meeting-prep/09-01-SUMMARY.md`
</output>
